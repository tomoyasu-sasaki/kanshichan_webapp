= 🧠 監視ちゃん(KanshiChan) 行動分析システム仕様書
:toc: left
:toc-title: 目次
:toclevels: 4
:numbered:
:source-highlighter: highlight.js
:icons: font
:doctype: book
:version: 1.0.0
:author: KanshiChan AI/ML Team
:email: ai-team@kanshichan.dev
:revnumber: 1.0
:revdate: {docdate}
:experimental:

== 📋 ドキュメント情報

[cols="1,3", options="header"]
|===
|項目 |詳細
|**作成者** |KanshiChan AI/ML開発チーム
|**最終更新日** |{docdate}
|**対象読者** |AI/MLエンジニア、データサイエンティスト、システムアーキテクト
|**文書バージョン** |{revnumber}
|**システムバージョン** |KanshiChan v2.0
|**レビュー状況** |初版作成完了
|===

[IMPORTANT]
====
🎯 **このドキュメントの目的**

監視ちゃん（KanshiChan）の行動分析システムについて、AI/ML機能の詳細実装、パターン認識アルゴリズム、健康評価指標、および個人化エンジンの技術仕様を包括的に解説します。

**想定読者**: AI/MLエンジニア、データサイエンティスト、システムアーキテクト
====

== 🌟 システム概要

=== 📖 行動分析システムとは

監視ちゃんの行動分析システムは、YOLOv8とMediaPipeによるリアルタイム検出データを基に、ユーザーの作業パターン、集中度、健康状態を分析する高度なAI/MLエンジンです。

=== 🏗️ アーキテクチャ概要

[mermaid]
....
graph TB
    subgraph "🔍 データ収集層"
        A1[YOLOv8検出器]
        A2[MediaPipe姿勢検出]
        A3[フレーム処理エンジン]
    end
    
    subgraph "📊 データ処理層"
        B1[BehaviorLog<br/>データモデル]
        B2[データ前処理<br/>パイプライン]
        B3[特徴量エンジニアリング]
    end
    
    subgraph "🧠 分析エンジン層"
        C1[AdvancedBehaviorAnalyzer<br/>高度行動分析]
        C2[PatternRecognizer<br/>パターン認識]
        C3[UserProfileBuilder<br/>個人化エンジン]
    end
    
    subgraph "📈 分析モジュール"
        D1[時系列パターン分析]
        D2[集中度詳細分析]
        D3[健康評価分析]
        D4[活動パターン分析]
        D5[予測分析]
    end
    
    subgraph "🎯 出力・活用層"
        E1[リアルタイム<br/>WebSocket配信]
        E2[REST API<br/>エンドポイント]
        E3[レポート生成]
        E4[推奨アクション]
    end
    
    A1 --> B1
    A2 --> B1
    A3 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> C1
    B3 --> C2
    B3 --> C3
    
    C1 --> D1
    C1 --> D2
    C1 --> D3
    C1 --> D4
    C2 --> D5
    C3 --> D5
    
    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
    D5 --> E4
    
    classDef dataLayer fill:#e1f5fe
    classDef processLayer fill:#f3e5f5
    classDef analysisLayer fill:#e8f5e8
    classDef moduleLayer fill:#fff3e0
    classDef outputLayer fill:#fce4ec
    
    class A1,A2,A3 dataLayer
    class B1,B2,B3 processLayer
    class C1,C2,C3 analysisLayer
    class D1,D2,D3,D4,D5 moduleLayer
    class E1,E2,E3,E4 outputLayer
....

=== 🔧 技術スタック

[cols="2,3,2", options="header"]
|===
|カテゴリ |技術・ライブラリ |バージョン
|**機械学習** |YOLOv8 (ultralytics) |>=8.3.87
|**コンピュータビジョン** |MediaPipe |>=0.10.21
|**数値計算** |NumPy |>=1.26.4
|**データ処理** |Pandas |>=2.0.0
|**深層学習** |PyTorch |>=2.5.1
|**画像処理** |OpenCV |>=4.11
|**統計分析** |SciPy |>=1.11.0
|===

== 📊 データモデル仕様

=== 🗃️ BehaviorLogモデル

行動分析システムの中核となるデータモデル：

[source,python]
----
class BehaviorLog(BaseModel):
    """行動ログモデル - リアルタイム監視データの記録"""
    
    # タイムスタンプ（インデックス付き）
    timestamp = Column(DateTime, nullable=False, index=True)
    
    # YOLOv8検出結果
    detected_objects = Column(JSON, nullable=True)
    object_count = Column(JSON, nullable=True)
    
    # MediaPipe集中度・姿勢データ
    focus_level = Column(Float, nullable=True)  # 0.0-1.0
    posture_data = Column(JSON, nullable=True)
    face_landmarks = Column(JSON, nullable=True)
    
    # スマートフォン使用状況
    smartphone_detected = Column(Boolean, default=False)
    smartphone_duration = Column(Float, nullable=True)
    
    # 状態判定結果
    presence_status = Column(String(20), nullable=True)  # present/absent/break
    attention_status = Column(String(20), nullable=True)  # focused/distracted/unknown
    
    # セッション情報
    session_id = Column(String(50), nullable=True, index=True)
    work_category = Column(String(50), nullable=True)
----

=== 📈 データ構造設計

[mermaid]
....
erDiagram
    BEHAVIOR_LOG {
        datetime timestamp PK
        json detected_objects
        json object_count
        float focus_level
        json posture_data
        boolean smartphone_detected
        string presence_status
        string attention_status
        string session_id
        string work_category
    }
    
    BEHAVIOR_TIMELINE {
        string timeline_id PK
        date timeline_date
        string session_id FK
        json timeline_events
        json state_transitions
        json pattern_analysis
    }
    
    USER_PROFILE {
        string user_id PK
        json behavioral_patterns
        json preferences
        json optimization_settings
        datetime last_updated
    }
    
    ANALYSIS_RESULT {
        string analysis_id PK
        datetime timestamp
        string analysis_type
        json results
        float confidence_score
    }
    
    BEHAVIOR_LOG ||--o{ BEHAVIOR_TIMELINE : builds
    BEHAVIOR_LOG ||--o{ ANALYSIS_RESULT : generates
    USER_PROFILE ||--o{ ANALYSIS_RESULT : customizes
....

== 🧠 AdvancedBehaviorAnalyzer 詳細仕様

=== 📋 クラス概要

`AdvancedBehaviorAnalyzer`は、基本的な`BehaviorAnalyzer`を拡張した高度分析エンジンです。

[source,python]
----
class AdvancedBehaviorAnalyzer:
    """高度行動パターン分析エンジン
    
    既存のBehaviorAnalyzerを拡張し、より詳細で高度な分析機能を提供
    """
    
    def __init__(self, config: Dict[str, Any]):
        # 分析パラメータ設定
        self.focus_thresholds = {
            'high': config.get('focus_threshold_high', 0.8),
            'medium': config.get('focus_threshold_medium', 0.6),
            'low': config.get('focus_threshold_low', 0.4)
        }
        
        self.health_params = {
            'max_sitting_minutes': config.get('max_sitting_minutes', 60),
            'min_movement_frequency': config.get('min_movement_frequency', 0.1),
            'eye_strain_threshold': config.get('eye_strain_threshold', 45)
        }
----

=== 🔍 主要分析メソッド

==== 📊 時系列パターン分析

[source,python]
----
def analyze_time_series_patterns(self, logs: List[BehaviorLog], 
                               analysis_window: str = "daily") -> Dict[str, Any]:
    """時系列パターン分析
    
    Args:
        logs: 行動ログリスト
        analysis_window: 分析ウィンドウ（hourly/daily/weekly/monthly）
        
    Returns:
        dict: 時系列パターン分析結果
    """
    # データ前処理
    df = self._prepare_timeseries_data(logs)
    
    # 季節性・周期性検出
    seasonality_analysis = self._detect_seasonality(df, analysis_window)
    
    # トレンド分析
    trend_analysis = self._analyze_trends(df)
    
    # 変化点検出
    change_points = self._detect_change_points(df)
    
    # パターン分類
    patterns = self._classify_patterns(df, seasonality_analysis, trend_analysis)
    
    # 予測生成
    predictions = self._generate_predictions(df, patterns)
----

==== 🎯 集中度詳細分析

集中度の詳細分析により、ユーザーの認知状態を深く理解：

[source,python]
----
def analyze_focus_detailed(self, logs: List[BehaviorLog]) -> Dict[str, Any]:
    """集中度詳細分析"""
    
    # 集中セッションの抽出
    focus_sessions = self._extract_focus_sessions(logs)
    
    # 集中度レベル分類
    level_classification = self._classify_focus_levels(logs)
    
    # 集中継続時間分析
    duration_analysis = self._analyze_focus_duration(focus_sessions)
    
    # 集中阻害要因特定
    distraction_analysis = self._analyze_focus_distractions(logs)
    
    # 最適集中時間帯推定
    optimal_periods = self._estimate_optimal_focus_periods(logs)
----

==== 🏥 健康評価分析

姿勢と健康状態の総合評価：

[source,python]
----
def analyze_health_assessment(self, logs: List[BehaviorLog]) -> Dict[str, Any]:
    """姿勢・健康分析"""
    
    # 姿勢パターン分析
    posture_analysis = self._analyze_posture_patterns(logs)
    
    # 長時間同一姿勢検出
    sitting_analysis = self._analyze_prolonged_sitting(logs)
    
    # 運動・休憩パターン分析
    movement_analysis = self._analyze_movement_patterns(logs)
    
    # アイストレイン評価
    eye_strain_analysis = self._analyze_eye_strain_risk(logs)
    
    # 総合健康リスク評価
    health_assessment = self._calculate_health_assessment(
        posture_analysis, sitting_analysis, movement_analysis, eye_strain_analysis
    )
----

=== 📏 分析指標とデータクラス

==== 🎯 FocusSession データクラス

[source,python]
----
@dataclass
class FocusSession:
    """集中セッションデータクラス"""
    start_time: datetime
    end_time: datetime
    duration_minutes: float
    average_focus: float
    focus_level: FocusLevel  # HIGH/MEDIUM/LOW/SCATTERED
    interruptions: int
    quality_score: float
    distractions: List[str]
----

==== 🏥 HealthAssessment データクラス

[source,python]
----
@dataclass
class HealthAssessment:
    """健康評価データクラス"""
    posture_score: float
    movement_frequency: float
    eye_strain_risk: float
    overall_risk: HealthRiskLevel  # LOW/MODERATE/HIGH/CRITICAL
    recommendations: List[str]
    break_intervals: List[int]  # 推奨休憩間隔（分）
----

==== 📊 ProductivityMetrics データクラス

[source,python]
----
@dataclass
class ProductivityMetrics:
    """生産性指標データクラス"""
    efficiency_score: float
    focus_consistency: float
    optimal_work_periods: List[Tuple[int, int]]  # (開始時間, 終了時間) ペア
    distractions_per_hour: float
    break_effectiveness: float
----

== 🔍 PatternRecognizer 機能仕様

=== 🎯 概要

`PatternRecognizer`は機械学習を活用した高度なパターン認識エンジンです。

[source,python]
----
class PatternRecognizer:
    """パターン認識エンジン
    
    機械学習アルゴリズムを使用した行動パターンの識別と予測
    """
    
    def __init__(self, config: Dict[str, Any]):
        self.clustering_config = config.get('clustering', {})
        self.pattern_thresholds = config.get('pattern_thresholds', {})
        self.learning_rate = config.get('learning_rate', 0.01)
----

=== 📊 主要機能

==== 🔮 時間的パターン認識

[source,python]
----
def recognize_temporal_patterns(self, logs: List[BehaviorLog]) -> Dict[str, Any]:
    """時間的パターン認識
    
    Returns:
        dict: 認識されたパターン
            - cyclical_patterns: 周期的パターン
            - trend_patterns: トレンドパターン
            - anomaly_patterns: 異常パターン
    """
----

==== 🎯 クラスタリング分析

[source,python]
----
def perform_clustering_analysis(self, logs: List[BehaviorLog]) -> Dict[str, Any]:
    """クラスタリング分析による行動パターン分類
    
    機械学習クラスタリング（K-means, DBSCAN）を使用
    """
----

==== 🧠 ユーザーパターン学習

[source,python]
----
def learn_user_patterns(self, logs: List[BehaviorLog], 
                       user_id: Optional[str] = None) -> Dict[str, Any]:
    """ユーザー固有パターンの学習
    
    個人の行動特性を学習し、パーソナライズされた分析を提供
    """
----

=== 📈 クラスタリング結果モデル

[source,python]
----
@dataclass
class BehaviorCluster:
    """行動クラスターデータクラス"""
    cluster_id: int
    cluster_type: str  # "high_focus", "distracted", "break_period", etc.
    center: List[float]  # クラスター中心座標
    size: int  # クラスター内データポイント数
    variance: float  # クラスター内分散
    typical_behaviors: List[str]  # 典型的な行動パターン
    time_periods: List[Tuple[int, int]]  # 発生時間帯
----

== 👤 UserProfileBuilder 個人化エンジン

=== 🎯 概要

`UserProfileBuilder`は個人の行動特性を学習し、パーソナライズされた分析を提供する個人化エンジンです。

[source,python]
----
class UserProfileBuilder:
    """ユーザープロファイル構築サービス
    
    個人特性分析、学習履歴管理、動的プロファイル更新
    """
    
    def __init__(self, config: Dict[str, Any]):
        self.profile_update_threshold = config.get('profile_update_threshold', 0.1)
        self.learning_window_days = config.get('learning_window_days', 30)
----

=== 📊 主要機能

==== 🔍 基本特性分析

[source,python]
----
def analyze_basic_characteristics(self, logs: List[BehaviorLog]) -> Dict[str, Any]:
    """基本特性分析
    
    Returns:
        - 集中パターン特性
        - 時間帯別パフォーマンス
        - 行動一貫性指標
    """
----

==== 📈 プロファイル動的更新

[source,python]
----
def update_profile_dynamically(self, user_id: str, 
                             new_logs: List[BehaviorLog]) -> Dict[str, Any]:
    """プロファイル動的更新
    
    新しいデータに基づいてユーザープロファイルを継続的に更新
    """
----

== 🔧 API エンドポイント

=== 📡 高度パターン分析API

[source,http]
----
GET /api/analysis/advanced-patterns
----

**Query Parameters:**

[cols="2,2,1,3", options="header"]
|===
|パラメータ |型 |必須 |説明
|`timeframe` |string |✅ |分析期間 (hourly/daily/weekly/monthly)
|`user_id` |string |❌ |ユーザーID
|`pattern_type` |string |❌ |パターンタイプ (cyclical/trending/seasonal/all)
|===

**Response例:**

[source,json]
----
{
  "status": "success",
  "data": {
    "timeframe": "daily",
    "pattern_type": "all",
    "total_logs": 1440,
    "timeseries_analysis": {
      "seasonality": {
        "detected": true,
        "period": 120,
        "strength": 0.85
      },
      "trends": {
        "focus_trend": "improving",
        "slope": 0.02,
        "r_squared": 0.78
      }
    },
    "pattern_recognition": {
      "cyclical_patterns": [
        {
          "pattern_type": "morning_focus_peak",
          "confidence": 0.92,
          "time_range": [9, 11]
        }
      ]
    }
  }
}
----

=== 📊 集中度詳細分析API

[source,http]
----
GET /api/analysis/focus-detailed
----

**Response例:**

[source,json]
----
{
  "status": "success",
  "data": {
    "focus_sessions": [
      {
        "start_time": "2024-01-15T09:00:00Z",
        "end_time": "2024-01-15T10:30:00Z",
        "duration_minutes": 90,
        "average_focus": 0.85,
        "focus_level": "HIGH",
        "interruptions": 2,
        "quality_score": 0.88
      }
    ],
    "quality_metrics": {
      "overall_quality": 0.82,
      "consistency_score": 0.75,
      "efficiency_ratio": 0.90
    },
    "recommendations": [
      "午前中の高集中時間を活用した重要タスクのスケジューリングを推奨",
      "13:00-15:00の集中度低下時期には軽作業を割り当て"
    ]
  }
}
----

=== 🏥 健康評価API

[source,http]
----
GET /api/analysis/health-assessment
----

**Response例:**

[source,json]
----
{
  "status": "success",
  "data": {
    "health_assessment": {
      "posture_score": 0.72,
      "movement_frequency": 0.15,
      "eye_strain_risk": 0.68,
      "overall_risk": "MODERATE"
    },
    "break_recommendations": [
      {
        "type": "posture_break",
        "interval_minutes": 45,
        "duration_minutes": 5
      },
      {
        "type": "eye_rest",
        "interval_minutes": 20,
        "duration_minutes": 2
      }
    ]
  }
}
----

== ⚙️ 設定・最適化

=== 📋 分析パラメータ設定

[source,yaml]
----
# config/config.yaml - 行動分析関連設定

advanced_analyzer:
  # 集中度閾値設定
  focus_threshold_high: 0.8
  focus_threshold_medium: 0.6
  focus_threshold_low: 0.4
  
  # 健康評価パラメータ
  max_sitting_minutes: 60
  min_movement_frequency: 0.1
  eye_strain_threshold: 45
  
  # 生産性重み付け
  productivity_weights:
    focus_consistency: 0.3
    efficiency: 0.25
    break_timing: 0.2
    distraction_control: 0.25

pattern_recognizer:
  # クラスタリング設定
  clustering:
    algorithm: "kmeans"  # kmeans, dbscan
    n_clusters: 5
    min_samples: 10
  
  # パターン閾値
  pattern_thresholds:
    cyclical_confidence: 0.7
    trend_significance: 0.05
    anomaly_threshold: 2.0

user_profile_builder:
  # プロファイル更新設定
  profile_update_threshold: 0.1
  learning_window_days: 30
  adaptation_rate: 0.05
----

=== 🔧 パフォーマンス最適化

==== 📊 データ処理最適化

[source,python]
----
# データバッファリングとキャッシュ
class AdvancedBehaviorAnalyzer:
    def __init__(self, config: Dict[str, Any]):
        # 分析キャッシュ
        self.analysis_cache = {}
        
        # パターン履歴（循環バッファ）
        self.pattern_history = deque(maxlen=1000)
        
        # メモリ効率化
        self._setup_memory_optimization()
----

==== ⚡ リアルタイム分析最適化

[source,python]
----
def _optimize_realtime_analysis(self):
    """リアルタイム分析の最適化"""
    
    # インクリメンタル分析
    # 全データ再計算を避け、新データのみを処理
    
    # バッチ処理による効率化
    # 複数データポイントをまとめて処理
    
    # 非同期処理による応答性向上
    # 重い分析を別スレッドで実行
----

== 📈 分析結果の活用

=== 🎯 リアルタイム分析フロー

[mermaid]
....
sequenceDiagram
    participant Frontend as フロントエンド
    participant WebSocket as WebSocket
    participant Analyzer as 分析エンジン
    participant Cache as キャッシュ
    participant DB as データベース
    
    Frontend->>WebSocket: 分析リクエスト
    WebSocket->>Analyzer: analyze_real_time()
    
    alt キャッシュヒット
        Analyzer->>Cache: get_cached_result()
        Cache-->>Analyzer: cached_data
    else キャッシュミス
        Analyzer->>DB: get_recent_logs()
        DB-->>Analyzer: behavior_logs
        Analyzer->>Analyzer: perform_analysis()
        Analyzer->>Cache: cache_result()
    end
    
    Analyzer-->>WebSocket: analysis_result
    WebSocket-->>Frontend: real_time_update
....

=== 📊 分析結果レポート生成

==== 📋 包括的レポート生成

[source,python]
----
def generate_comprehensive_report(self, logs: List[BehaviorLog], 
                                timeframe: str = "daily") -> Dict[str, Any]:
    """包括的分析レポート生成"""
    
    # 各種分析の実行
    timeseries_analysis = self.analyze_time_series_patterns(logs, timeframe)
    focus_analysis = self.analyze_focus_detailed(logs)
    health_analysis = self.analyze_health_assessment(logs)
    activity_analysis = self.analyze_activity_patterns(logs)
    
    # 統合評価スコア算出
    overall_score = self._calculate_overall_score(
        focus_analysis, health_analysis, activity_analysis
    )
    
    # 優先度付き推奨事項生成
    prioritized_recommendations = self._generate_prioritized_recommendations(
        focus_analysis, health_analysis, activity_analysis
    )
    
    return {
        'executive_summary': executive_summary,
        'overall_score': overall_score,
        'detailed_analysis': {
            'timeseries': timeseries_analysis,
            'focus': focus_analysis,
            'health': health_analysis,
            'activity': activity_analysis
        },
        'recommendations': prioritized_recommendations
    }
----

=== 🎯 推奨アクション生成

[source,python]
----
def _generate_prioritized_recommendations(self, focus_analysis, 
                                        health_analysis, activity_analysis):
    """優先度付き推奨事項生成"""
    
    recommendations = []
    
    # 健康リスクが最優先
    if health_analysis['health_assessment']['overall_risk'] == 'HIGH':
        recommendations.append({
            'priority': 'CRITICAL',
            'category': 'health',
            'action': '即座に休憩を取り、姿勢を改善してください',
            'reason': '長時間の不良姿勢が検出されました'
        })
    
    # 集中度改善提案
    if focus_analysis['quality_metrics']['overall_quality'] < 0.6:
        recommendations.append({
            'priority': 'HIGH',
            'category': 'productivity',
            'action': '集中時間帯の活用を推奨',
            'reason': '午前中の集中度が最も高い傾向があります'
        })
    
    return recommendations
----

== 🧪 テスト・検証

=== 🔬 単体テスト

[source,python]
----
import pytest
from unittest.mock import Mock, patch
from services.ai_ml.advanced_behavior_analyzer import AdvancedBehaviorAnalyzer

class TestAdvancedBehaviorAnalyzer:
    
    def test_analyze_time_series_patterns(self):
        """時系列パターン分析のテスト"""
        config = {'advanced_analyzer': {}}
        analyzer = AdvancedBehaviorAnalyzer(config)
        
        # モックデータ作成
        mock_logs = self._create_mock_behavior_logs()
        
        # 分析実行
        result = analyzer.analyze_time_series_patterns(mock_logs, "daily")
        
        # 結果検証
        assert 'seasonality' in result
        assert 'trends' in result
        assert 'patterns' in result
    
    def test_focus_detailed_analysis(self):
        """集中度詳細分析のテスト"""
        # テスト実装
        pass
    
    def test_health_assessment(self):
        """健康評価分析のテスト"""
        # テスト実装
        pass
----

=== 📊 統合テスト

[source,python]
----
class TestBehaviorAnalysisIntegration:
    
    def test_end_to_end_analysis_pipeline(self):
        """エンドツーエンド分析パイプラインのテスト"""
        
        # 1. データ生成
        logs = self._generate_realistic_behavior_data()
        
        # 2. 全分析エンジンの実行
        analyzer = AdvancedBehaviorAnalyzer(config)
        recognizer = PatternRecognizer(config)
        profile_builder = UserProfileBuilder(config)
        
        # 3. 分析結果の一貫性確認
        analysis_result = analyzer.generate_comprehensive_report(logs)
        pattern_result = recognizer.recognize_temporal_patterns(logs)
        profile_result = profile_builder.analyze_basic_characteristics(logs)
        
        # 4. 結果統合の確認
        assert self._validate_analysis_consistency(
            analysis_result, pattern_result, profile_result
        )
----

== 🔒 セキュリティ・プライバシー

=== 🛡️ データ保護

[WARNING]
====
**プライバシー保護の重要性**

行動分析システムは個人の詳細な行動データを扱うため、以下のセキュリティ対策が必須です：

* **データ匿名化**: 個人識別情報の除去
* **暗号化**: 保存・転送時の暗号化
* **アクセス制御**: 分析者のみアクセス可能
* **データ保持期間**: 必要最小限の期間のみ保持
====

[source,python]
----
class PrivacyProtectedAnalyzer:
    """プライバシー保護分析器"""
    
    def anonymize_behavior_data(self, logs: List[BehaviorLog]) -> List[BehaviorLog]:
        """行動データの匿名化"""
        
        for log in logs:
            # 個人識別可能な情報の除去
            log.face_landmarks = self._anonymize_face_data(log.face_landmarks)
            log.session_id = self._hash_session_id(log.session_id)
        
        return logs
    
    def encrypt_analysis_results(self, results: Dict[str, Any]) -> str:
        """分析結果の暗号化"""
        # AES暗号化実装
        pass
----

== 📚 トラブルシューティング

=== ❗ よくある問題と解決策

[cols="2,3,3", options="header"]
|===
|問題 |原因 |解決策
|**分析結果が空** |データ不足またはフィルター条件が厳しすぎる |データ期間を拡大、閾値を調整
|**メモリ使用量過多** |大量データの一括処理 |バッチサイズを小さくし、キャッシュをクリア
|**分析速度が遅い** |非最適化クエリ |インデックスの確認、クエリ最適化
|**パターン認識精度低下** |学習データ不足 |データ収集期間を延長、パラメータ調整
|===

=== 🔧 デバッグ方法

[source,python]
----
# ログレベルを DEBUG に設定
import logging
logging.getLogger('services.ai_ml.advanced_behavior_analyzer').setLevel(logging.DEBUG)

# 分析プロセスの可視化
def debug_analysis_pipeline(logs: List[BehaviorLog]):
    """分析パイプラインのデバッグ"""
    
    analyzer = AdvancedBehaviorAnalyzer(config)
    
    # 各ステップの実行時間測定
    with timer("data_preparation"):
        df = analyzer._prepare_timeseries_data(logs)
    
    with timer("seasonality_detection"):
        seasonality = analyzer._detect_seasonality(df, "daily")
    
    # 中間結果の確認
    logger.debug(f"Processed {len(df)} data points")
    logger.debug(f"Seasonality detected: {seasonality['detected']}")
----

== 📖 参考資料

=== 🔗 関連ドキュメント

* <<detection-system.adoc#,物体・姿勢検出システム仕様書>>
* <<ai-ml-specifications.adoc#,AI/ML技術仕様書>>
* <<rest-api-reference.adoc#,REST API リファレンス>>
* <<database-schema.adoc#,データベーススキーマ設計書>>

=== 📚 技術参考文献

* YOLOv8 公式ドキュメント: https://docs.ultralytics.com/
* MediaPipe 公式ガイド: https://mediapipe.dev/
* 時系列分析手法: 季節性分解、変化点検出
* 機械学習クラスタリング: K-means, DBSCAN

=== 🤝 開発チームコンタクト

[cols="2,3", options="header"]
|===
|役割 |連絡先
|**AI/MLアーキテクト** |ai-architect@kanshichan.dev
|**データサイエンティスト** |data-scientist@kanshichan.dev
|**技術サポート** |tech-support@kanshichan.dev
|===

---

**📞 Contact**: ai-team@kanshichan.dev +
**🔗 Repository**: https://github.com/kanshichan/backend +
**📅 Last Updated**: {docdate} +
**📝 Document Version**: {revnumber}