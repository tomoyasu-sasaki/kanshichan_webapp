= 🌐 監視ちゃん(KanshiChan) REST API リファレンス
:toc: left
:toc-title: 目次
:toclevels: 4
:numbered:
:source-highlighter: highlight.js
:icons: font
:doctype: book
:version: 2.0.0
:author: KanshiChan Development Team
:email: team@kanshichan.dev
:revnumber: 2.0
:revdate: {docdate}
:experimental:

== 📖 概要

監視ちゃん（KanshiChan）のREST API仕様書です。
このAPIは、リアルタイム行動監視・分析システムの全機能にプログラマティックにアクセスするためのインターフェースを提供します。

[NOTE]
====
📋 **API情報**

* **ベースURL**: `http://localhost:8000/api`
* **プロトコル**: HTTP/1.1
* **認証**: なし（ローカル専用）
* **レスポンス形式**: JSON
* **API バージョン**: v2.0
* **最終更新**: {docdate}
====

== 🎯 API概要

=== 💡 設計原則

* **RESTful**: 標準的なREST設計パターンに準拠
* **統一フォーマット**: 全エンドポイントで統一されたレスポンス形式
* **エラーハンドリング**: 詳細なエラー情報とコードの提供
* **パフォーマンス**: 高速レスポンスとページング対応
* **拡張性**: 将来の機能拡張に対応した設計

=== 📊 エンドポイント分類

[cols="2,3,2", options="header"]
|===
|カテゴリ |説明 |エンドポイント数
|**🔍 Basic Analysis** |基本的な行動分析・トレンド |4個
|**🧠 Advanced Analysis** |高度パターン分析・機械学習 |4個
|**🔮 Prediction Analysis** |予測・パーソナライゼーション |4個
|**⚡ Realtime Analysis** |リアルタイムデータ処理 |4個
|**📊 Behavior Data** |行動ログデータ操作 |4個
|**🔊 TTS System** |音声合成・TTS機能 |15個
|**📈 Monitoring** |システム監視・管理 |4個
|===

== 🔍 Basic Analysis API

基本的な行動分析機能を提供するAPIエンドポイント群

=== GET /api/analysis/status

==== 概要
分析システムの現在状態を取得

==== パラメータ
なし

==== レスポンス例
```json
{
  "status": "success",
  "data": {
    "system_status": "operational",
    "active_analyzers": 3,
    "detection_status": {
      "yolo_enabled": true,
      "mediapipe_enabled": true,
      "fps": 15.2
    },
    "analysis_capabilities": {
      "behavior_analysis": true,
      "pattern_recognition": true,
      "predictive_modeling": true
    },
    "performance": {
      "cpu_usage": 45.2,
      "memory_usage": 1200,
      "gpu_usage": 60.5
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== GET /api/analysis/trends

==== 概要
指定期間の行動トレンドを分析

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`timeframe` |string |❌ |分析期間 (`hourly`/`daily`/`weekly`) デフォルト: `daily`
|`user_id` |string |❌ |ユーザーID
|===

==== レスポンス例
```json
{
  "status": "success",
  "data": {
    "timeframe": "daily",
    "period_start": "2024-01-14T00:00:00Z",
    "period_end": "2024-01-15T00:00:00Z",
    "total_logs": 2772,
    "focus_analysis": {
      "average_focus": 0.48,
      "good_posture_percentage": 0.85,
      "presence_rate": 0.91,
      "smartphone_usage_rate": 0.012,
      "total_sessions": 9,
      "trend_direction": "stable"
    },
    "hourly_patterns": [
      {
        "hour": 9,
        "focus_score": 0.65,
        "activity_level": "high"
      }
    ]
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== GET /api/analysis/insights

==== 概要
日次インサイトと改善提案を取得

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`user_id` |string |❌ |ユーザーID
|`days` |integer |❌ |分析対象日数 (1-30) デフォルト: 7
|`include_recommendations` |boolean |❌ |推奨事項を含める デフォルト: `true`
|===

=== GET /api/analysis/recommendations

==== 概要
現在の行動状況に基づく推奨事項を取得

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`user_id` |string |❌ |ユーザーID
|`priority` |string |❌ |優先度フィルタ (`high`/`medium`/`low`)
|`limit` |integer |❌ |最大返却数 (1-20) デフォルト: 5
|===

== 🧠 Advanced Analysis API

高度なパターン分析と機械学習機能を提供するAPIエンドポイント群

=== GET /api/analysis/advanced-patterns

==== 概要
高度な行動パターン分析と機械学習ベースの洞察を提供

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`timeframe` |string |❌ |分析期間 (`hourly`/`daily`/`weekly`/`monthly`) デフォルト: `daily`
|`user_id` |string |❌ |ユーザーID
|`pattern_type` |string |❌ |パターンタイプ (`cyclical`/`trending`/`seasonal`/`all`) デフォルト: `all`
|===

=== GET /api/analysis/focus-deep-dive

==== 概要
集中度に関する詳細な分析と品質評価を提供

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`user_id` |string |❌ |ユーザーID
|`hours` |integer |❌ |分析対象時間 (1-720) デフォルト: 24
|`include_sessions` |boolean |❌ |セッション詳細を含める デフォルト: `true`
|===

=== GET /api/analysis/health-assessment

==== 概要
姿勢、健康状態、リスクアセスメントを提供

=== GET /api/analysis/productivity-score

==== 概要
作業効率、生産性指標、活動パターン分析を提供

== 🔮 Prediction Analysis API

機械学習ベースの予測分析とパーソナライゼーション機能

=== GET /api/analysis/predictions

==== 概要
機械学習ベースの行動予測と将来のパターン予測

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`user_id` |string |❌ |ユーザーID
|`metrics` |string |❌ |予測対象指標 (カンマ区切り) デフォルト: `focus_score,posture_score`
|`horizon` |integer |❌ |予測時間（分） (5-1440) デフォルト: 60
|===

=== GET /api/analysis/personalized-recommendations

==== 概要
ユーザーの個人特性とコンテキストに基づいた最適化された推奨事項

=== GET /api/analysis/user-profile

==== 概要
ユーザーの行動プロファイルと学習済み特性

=== POST /api/analysis/adaptive-learning

==== 概要
ユーザーフィードバックに基づく適応学習

== ⚡ Realtime Analysis API

リアルタイムデータ処理と監視機能

=== POST /api/analysis/realtime-stream

==== 概要
リアルタイム分析用のデータストリームに新しいデータポイントを追加

==== リクエストボディ
```json
{
  "user_id": "string",
  "data": {
    "eye_movement": {...},
    "pose_data": {...},
    "environment": {...}
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== GET /api/analysis/stream-status

==== 概要
リアルタイムストリーミングの現在状態

=== GET /api/analysis/alerts

==== 概要
アクティブなアラートと通知を取得

=== GET /api/analysis/performance-report

==== 概要
システムパフォーマンスの詳細レポート

== 📊 Behavior Data API

行動ログデータの取得、操作、エクスポート機能

=== GET /api/behavior/logs

==== 概要
行動ログデータの取得（ページング、フィルタリング対応）

==== パラメータ
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`page` |integer |❌ |ページ番号 (1から開始) デフォルト: 1
|`per_page` |integer |❌ |1ページあたりの件数 (1-100) デフォルト: 20
|`start_date` |string |❌ |開始日時 (ISO 8601形式)
|`end_date` |string |❌ |終了日時 (ISO 8601形式)
|`user_id` |string |❌ |ユーザーID
|`focus_min` |float |❌ |最低集中度 (0.0-1.0)
|`focus_max` |float |❌ |最高集中度 (0.0-1.0)
|`smartphone_detected` |boolean |❌ |スマートフォン検出フィルタ
|`presence_status` |string |❌ |在席状態 (`present`/`absent`/`unknown`)
|`order_by` |string |❌ |ソート順 (`timestamp_asc`/`timestamp_desc`) デフォルト: `timestamp_desc`
|===

==== レスポンス例
```json
{
  "status": "success",
  "data": {
    "logs": [
      {
        "id": 1,
        "timestamp": "2024-01-15T10:30:00Z",
        "person_detected": true,
        "smartphone_detected": false,
        "presence_status": "present",
        "posture_score": 0.85,
        "attention_level": 0.72
      }
    ],
    "pagination": {
      "page": 1,
      "per_page": 20,
      "total": 2772,
      "pages": 139
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== GET /api/behavior/summary

==== 概要
指定期間の行動データの統計サマリー

=== GET /api/behavior/stats

==== 概要
期間別の詳細な統計情報

=== GET /api/behavior/export

==== 概要
行動データのCSV/JSON形式エクスポート

== 🔊 TTS System API

音声合成・TTS機能とボイス管理

=== 🎤 音声合成エンドポイント

==== POST /api/tts/synthesize

音声合成実行API

**パラメータ**:
[cols="2,1,1,4", options="header"]
|===
|パラメータ |型 |必須 |説明
|`text` |string |✅ |合成するテキスト
|`voice_id` |string |❌ |音声ID デフォルト: default
|`emotion` |string |❌ |感情 (`happy`/`sad`/`angry`/`neutral`) デフォルト: `neutral`
|`speed` |float |❌ |話速 (0.5-2.0) デフォルト: 1.0
|`pitch` |float |❌ |ピッチ (0.5-2.0) デフォルト: 1.0
|===

==== GET /api/tts/voices

利用可能な音声一覧取得

==== POST /api/tts/voice-clone

音声クローニング（カスタム音声作成）

=== 🎵 ストリーミング・ファイル管理

==== GET /api/tts/stream

リアルタイム音声ストリーミング

==== GET /api/tts/files

音声ファイル一覧取得

==== DELETE /api/tts/files/{file_id}

音声ファイル削除

=== ⚙️ システム管理

==== GET /api/tts/status

TTSシステム状態取得

==== POST /api/tts/configure

TTS設定更新

== 📈 Monitoring API

システム監視と管理機能

=== GET /api/monitor/status

==== 概要
監視システムの総合的な状態取得

==== レスポンス例
```json
{
  "status": "success",
  "data": {
    "monitor_status": "active",
    "fps": 15.2,
    "detection_active": true,
    "alerts_count": 0,
    "uptime_seconds": 3600,
    "performance": {
      "cpu_usage": 45.2,
      "memory_mb": 1200,
      "gpu_usage": 60.5
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== POST /api/monitor/start

監視開始

=== POST /api/monitor/stop

監視停止

=== GET /api/monitor/metrics

詳細なシステムメトリクス取得

== 📋 共通仕様

=== 🔄 レスポンス形式

全APIエンドポイントは以下の統一形式でレスポンスを返します：

==== 成功レスポンス
```json
{
  "status": "success",
  "data": { /* エンドポイント固有のデータ */ },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

==== エラーレスポンス
```json
{
  "status": "error",
  "error": "エラーメッセージ",
  "code": "ERROR_CODE",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

=== ⚠️ エラーコード

[cols="2,1,4", options="header"]
|===
|エラーコード |HTTPステータス |説明
|`VALIDATION_ERROR` |400 |リクエストパラメータの検証エラー
|`SERVICE_UNAVAILABLE` |500 |サービスが利用できない
|`ANALYSIS_ERROR` |500 |分析処理でエラーが発生
|`DATA_NOT_FOUND` |404 |要求されたデータが見つからない
|`PROCESSING_ERROR` |500 |データ処理でエラーが発生
|`AUTHENTICATION_ERROR` |401 |認証エラー
|`RATE_LIMIT_EXCEEDED` |429 |レート制限に達した
|===

=== 📊 ページング

大量のデータを返すエンドポイントでは、ページング機能を提供します：

```json
{
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "per_page": 20,
      "total": 2772,
      "pages": 139,
      "has_prev": false,
      "has_next": true
    }
  }
}
```

=== 🕐 日時形式

全ての日時はISO 8601形式（UTC）で表現します：
`2024-01-15T10:30:00Z`

=== 🎛️ フィルタリング

多くのエンドポイントで以下のフィルタリングオプションを提供：

* **時間範囲**: `start_date`, `end_date`
* **ユーザー**: `user_id`
* **数値範囲**: `min_value`, `max_value`
* **カテゴリ**: 特定の値でのフィルタリング

== 🚀 利用例とサンプル

=== 📊 基本的な監視データ取得

```javascript
// 現在のシステム状態を取得
const response = await fetch('/api/monitor/status');
const status = await response.json();

// 過去24時間の行動トレンドを取得
const trends = await fetch('/api/analysis/trends?timeframe=daily');
const trendData = await trends.json();

// 行動ログを取得（最新20件）
const logs = await fetch('/api/behavior/logs?per_page=20&order_by=timestamp_desc');
const logData = await logs.json();
```

=== 🔊 音声合成の利用

```javascript
// 音声合成実行
const audioResponse = await fetch('/api/tts/synthesize', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    text: '集中してください',
    emotion: 'encouraging',
    voice_id: 'default'
  })
});

const audioBlob = await audioResponse.blob();
const audio = new Audio(URL.createObjectURL(audioBlob));
audio.play();
```

=== 📈 高度な分析の活用

```javascript
// 高度パターン分析
const patterns = await fetch('/api/analysis/advanced-patterns?pattern_type=all&timeframe=weekly');
const patternData = await patterns.json();

// 予測分析
const predictions = await fetch('/api/analysis/predictions?metrics=focus_score&horizon=120');
const predictionData = await predictions.json();

// パーソナライズド推奨
const recommendations = await fetch('/api/analysis/personalized-recommendations?user_id=user123');
const recsData = await recommendations.json();
```

== 🔧 開発者ガイド

=== 📝 APIクライアント実装

==== Python例
```python
import requests
import json

class KanshiChanAPI:
    def __init__(self, base_url="http://localhost:8000/api"):
        self.base_url = base_url
    
    def get_status(self):
        response = requests.get(f"{self.base_url}/monitor/status")
        return response.json()
    
    def get_trends(self, timeframe="daily"):
        response = requests.get(f"{self.base_url}/analysis/trends", 
                               params={"timeframe": timeframe})
        return response.json()
    
    def synthesize_speech(self, text, emotion="neutral"):
        response = requests.post(f"{self.base_url}/tts/synthesize",
                                json={"text": text, "emotion": emotion})
        return response.content
```

==== TypeScript例
```typescript
interface APIResponse<T> {
  status: 'success' | 'error';
  data?: T;
  error?: string;
  code?: string;
  timestamp: string;
}

class KanshiChanAPI {
  constructor(private baseUrl = 'http://localhost:8000/api') {}
  
  async getStatus(): Promise<APIResponse<any>> {
    const response = await fetch(`${this.baseUrl}/monitor/status`);
    return response.json();
  }
  
  async getTrends(timeframe = 'daily'): Promise<APIResponse<any>> {
    const response = await fetch(`${this.baseUrl}/analysis/trends?timeframe=${timeframe}`);
    return response.json();
  }
}
```

=== 🛡️ エラーハンドリング

```javascript
async function safeAPICall(url, options = {}) {
  try {
    const response = await fetch(url, options);
    const data = await response.json();
    
    if (data.status === 'error') {
      throw new Error(`API Error: ${data.error} (${data.code})`);
    }
    
    return data.data;
  } catch (error) {
    console.error('API call failed:', error);
    throw error;
  }
}
```

=== ⚡ パフォーマンス最適化

* **バッチリクエスト**: 複数データの一括取得
* **キャッシュ活用**: 変更頻度の低いデータのクライアントサイドキャッシュ
* **ページング**: 大量データの段階的読み込み
* **WebSocket併用**: リアルタイムデータはWebSocket、メタデータはREST API

== 📚 関連ドキュメント

=== 📖 参照ドキュメント
* **<<backend-architecture>>**: システム全体アーキテクチャ
* **<<detection-system>>**: AI検出システム詳細
* **<<configuration-guide>>**: 設定・カスタマイズガイド
* **<<websocket-api>>**: WebSocket API仕様

=== 🔗 開発ツール
* **Postman Collection**: API テスト用コレクション
* **OpenAPI Spec**: Swagger/OpenAPI 3.0仕様書
* **SDK**: Python, TypeScript, JavaScript クライアントSDK

---

**📞 Contact**: team@kanshichan.dev +
**🔗 Repository**: https://github.com/kanshichan/backend +
**📅 Last Updated**: {docdate} +
**📝 Document Version**: {revnumber} 