= å–å¾—ãƒ‡ãƒ¼ã‚¿ã®åˆ†æå‡¦ç†å†…å®¹èª¿æŸ»å ±å‘Šæ›¸
:doctype: book
:toc: left
:toclevels: 3
:source-highlighter: highlight.js
:icons: font
:sectnums:
:xrefstyle: short

== æ¦‚è¦

æœ¬å ±å‘Šæ›¸ã¯ã€KanshiChanç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒæœŸå¾…ã™ã‚‹åˆ†æçµæœãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã¨ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒè¿”ã™åˆ†æçµæœãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã«ã¤ã„ã¦è©³ç´°ã«èª¿æŸ»ã—ã€ä¸¡è€…ã®å·®ç•°ã‚’åˆ†æã—ãŸçµæœã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

=== èª¿æŸ»ã®ç›®çš„

* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒæœŸå¾…ã™ã‚‹åˆ†æçµæœãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã¨å†…å®¹ã®æŠŠæ¡
* ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒè¿”ã™åˆ†æçµæœãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã¨å†…å®¹ã®æŠŠæ¡  
* ä¸¡è€…ã®å·®ç•°ã®ç‰¹å®šã¨åˆ†æ
* ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®çµ±ä¸€æ€§ã«é–¢ã™ã‚‹èª²é¡Œã®æŠ½å‡º

=== èª¿æŸ»å¯¾è±¡

* ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIä»•æ§˜ï¼ˆåˆ†æé–¢é€£ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰TypeScriptå‹å®šç¾©
* WebSocketé€šä¿¡ãƒ‡ãƒ¼ã‚¿å½¢å¼
* å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯

== ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆ†æçµæœãƒ‡ãƒ¼ã‚¿å½¢å¼

=== APIå…±é€šãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®çµ±ä¸€ã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’æ¡ç”¨ï¼š

[source,json]
----
// æˆåŠŸæ™‚
{
  "status": "success",
  "data": {...},
  "timestamp": "2024-12-27T10:30:00.000Z"
}

// ã‚¨ãƒ©ãƒ¼æ™‚
{
  "status": "error", 
  "error": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
  "code": "ERROR_CODE",
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

=== åŸºæœ¬åˆ†æAPI (`/api/analysis/trends`)

==== ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

[source,http]
----
GET /api/analysis/trends?timeframe=daily&user_id=optional
----

==== ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

[source,json]
----
{
  "status": "success",
  "data": {
    "timeframe": "daily",
    "period_start": "2024-12-26T10:30:00.000Z",
    "period_end": "2024-12-27T10:30:00.000Z", 
    "total_logs": 150,
    "focus_analysis": {
      "basic_statistics": {
        "mean": 0.65,
        "median": 0.70,
        "std_dev": 0.15,
        "min": 0.20,
        "max": 0.95
      },
      "trend_analysis": {
        "direction": "up",
        "strength": 0.75,
        "slope": 0.012,
        "trend_percentage": 12.5
      },
      "focus_patterns": {
        "peak_times": ["09:00-11:00", "14:00-16:00"],
        "low_times": ["12:00-13:00"],
        "pattern_strength": 0.8
      },
      "hourly_patterns": {
        "hour_averages": {...},
        "productivity_peaks": [...]
      }
    },
    "anomalies": [
      {
        "type": "posture_anomaly",
        "severity": "medium",
        "timestamp": "2024-12-27T08:30:00.000Z",
        "description": "é•·æ™‚é–“åŒä¸€å§¿å‹¢æ¤œå‡º"
      }
    ],
    "trend_summary": {
      "overall_trend": "improving",
      "key_metrics": {...}
    }
  },
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

=== é«˜åº¦åˆ†æAPI (`/api/analysis/advanced-patterns`)

==== ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

[source,json]
----
{
  "status": "success",
  "data": {
    "timeframe": "week",
    "pattern_type": "behavioral_patterns",
    "period_start": "2024-12-20T00:00:00.000Z",
    "period_end": "2024-12-27T00:00:00.000Z",
    "total_logs": 1050,
    "timeseries_analysis": {
      "trend_strength": 0.8,
      "trend_direction": "up",
      "seasonal_patterns": ["morning_peak", "afternoon_dip"],
      "anomalies_count": 3,
      "data_quality_score": 0.95
    },
    "pattern_recognition": {
      "behavioral_patterns": [
        {
          "pattern_type": "focus_cycle",
          "confidence": 0.85,
          "frequency": 3.2,
          "description": "90åˆ†é›†ä¸­ã‚µã‚¤ã‚¯ãƒ«",
          "recommendations": ["25åˆ†é›†ä¸­ã€5åˆ†ä¼‘æ†©ã‚’æ¨å¥¨"]
        }
      ]
    },
    "clustering_analysis": {
      "clusters": [
        {
          "cluster_id": 1,
          "characteristics": "é«˜é›†ä¸­çŠ¶æ…‹",
          "data_points": 320,
          "centroid": {...}
        }
      ]
    },
    "insights": [
      "åˆå‰ä¸­ã®é›†ä¸­åº¦ãŒæŒç¶šçš„ã«å‘ä¸Š",
      "ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ä½¿ç”¨ã«ã‚ˆã‚‹ä¸­æ–­ãŒæ¸›å°‘å‚¾å‘"
    ]
  },
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

=== äºˆæ¸¬åˆ†æAPI (`/api/analysis/predictions`)

==== ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

[source,json]
----
{
  "status": "success", 
  "data": {
    "prediction_horizon_hours": 24,
    "predictions": [
      {
        "metric": "focus_score",
        "current_value": 0.72,
        "predicted_value": 0.78,
        "confidence": 0.85,
        "trend": "increasing",
        "prediction_horizon_hours": 24,
        "factors_influencing": ["æŒç¶šçš„ãªé›†ä¸­æ”¹å–„", "ç’°å¢ƒæ¡ä»¶è‰¯å¥½"],
        "recommendations": ["ç¾åœ¨ã®ãƒšãƒ¼ã‚¹ã‚’ç¶­æŒ", "2æ™‚é–“æ¯ã®ä¼‘æ†©æ¨å¥¨"]
      }
    ],
    "trend_analysis": [
      {
        "period": "1é€±é–“",
        "trend_strength": 0.7,
        "trend_direction": "up",
        "seasonal_patterns": ["åˆå‰ä¸­ãƒ”ãƒ¼ã‚¯"],
        "anomalies_detected": 1
      }
    ],
    "future_scenarios": [
      {
        "scenario_name": "æœ€é©ç’°å¢ƒç¶™ç¶š",
        "probability": 0.75,
        "expected_outcomes": {
          "focus_score": 0.85,
          "productivity_score": 0.80,
          "health_score": 0.90
        },
        "key_factors": ["ç’°å¢ƒç¶­æŒ", "è¦å‰‡çš„ä¼‘æ†©"],
        "preventive_actions": ["å®šæœŸçš„ãªå§¿å‹¢ãƒã‚§ãƒƒã‚¯"]
      }
    ]
  },
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

=== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æAPI (`/api/analysis/realtime-stream`)

==== POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

[source,json]
----
{
  "user_id": "user123",
  "data": {
    "eye_movement": {
      "gaze_direction": {"x": 0.5, "y": 0.3},
      "blink_rate": 15,
      "focus_intensity": 0.8
    },
    "pose_data": {
      "head_pose": {"pitch": 5, "yaw": -2, "roll": 1},
      "shoulder_alignment": 0.9,
      "posture_score": 0.85
    },
    "environment": {
      "lighting_level": 0.7,
      "noise_level": 0.2,
      "screen_brightness": 0.6
    }
  },
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

==== ãƒ¬ã‚¹ãƒãƒ³ã‚¹

[source,json]
----
{
  "status": "success",
  "data": {
    "processing_result": "accepted",
    "realtime_analysis": {
      "current_focus_score": 0.82,
      "attention_state": "focused",
      "posture_assessment": "good",
      "break_recommendation": false,
      "anomaly_detected": false
    },
    "updated_metrics": {
      "session_average_focus": 0.75,
      "time_in_session": 3600,
      "alerts_triggered": 0
    }
  },
  "timestamp": "2024-12-27T10:30:00.000Z"
}
----

=== WebSocket ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿

==== status_update ã‚¤ãƒ™ãƒ³ãƒˆ

[source,json]
----
{
  "personDetected": true,
  "smartphoneDetected": false,
  "absenceTime": 0,
  "smartphoneUseTime": 45.5,
  "absenceAlert": false,
  "smartphoneAlert": false
}
----

==== behavior_data ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ‹¡å¼µï¼‰

[source,json]
----
{
  "focus_trends": [
    {
      "timestamp": "2024-12-27T10:30:00.000Z",
      "focus_score": 0.82,
      "posture_score": 0.90,
      "productivity_score": 0.75
    }
  ],
  "current_status": {
    "presence_status": "present",
    "smartphone_detected": false,
    "focus_level": 0.82,
    "posture_score": 0.90
  },
  "session_stats": {
    "total_logs": 150,
    "present_time_ratio": 0.95,
    "smartphone_usage_ratio": 0.05
  }
}
----

==== analysis_results ã‚¤ãƒ™ãƒ³ãƒˆ

[source,json]
----
[
  "é›†ä¸­åº¦ãŒéå»1æ™‚é–“ã§15%å‘ä¸Šã—ã¾ã—ãŸ",
  "å§¿å‹¢ãŒæ”¹å–„å‚¾å‘ã«ã‚ã‚Šã¾ã™",
  "ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ä½¿ç”¨æ™‚é–“ãŒç›®æ¨™å€¤ä»¥ä¸‹ã§ã™"
]
----

== ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…ãƒ‡ãƒ¼ã‚¿å½¢å¼

=== TypeScriptå‹å®šç¾©

==== åŸºæœ¬æ¤œå‡ºçŠ¶æ…‹

[source,typescript]
----
interface DetectionStatus {
  personDetected: boolean;
  smartphoneDetected: boolean;
  absenceTime: number;
  smartphoneUseTime: number;
  absenceAlert?: boolean;
  smartphoneAlert?: boolean;
}
----

==== åˆ†æãƒ‡ãƒ¼ã‚¿

[source,typescript]
----
interface AnalyticsData {
  timestamp: string;
  focus_score: number;
  posture_score: number;
  productivity_score: number;
  fatigue_level: number;
  distraction_count: number;
}
----

==== è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³

[source,typescript]
----
interface BehaviorPattern {
  pattern_type: string;
  confidence: number;
  frequency: number;
  description: string;
  recommendations: string[];
}
----

==== äºˆæ¸¬ã‚¤ãƒ³ã‚µã‚¤ãƒˆ

[source,typescript]
----
interface PredictiveInsight {
  metric: string;
  predicted_value: number;
  confidence: number;
  timestamp: string;
  trend: 'increasing' | 'decreasing' | 'stable';
}
----

==== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

[source,typescript]
----
interface PerformanceMetric {
  name: string;
  current_value: number;
  target_value: number;
  status: 'excellent' | 'good' | 'fair' | 'poor' | 'critical';
}
----

=== ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã§ã®æœŸå¾…å€¤

==== AdvancedAnalyticsDashboard.tsx

[source,typescript]
----
// æœŸå¾…ã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
const timeseriesResponse = await fetch(
  `${API_BASE_URL}/analysis/trends?timeframe=${selectedTimeframe}&user_id=${userId}`
);

const patternsResponse = await fetch(
  `${API_BASE_URL}/analysis/advanced-patterns?user_id=${userId}&timeframe=${selectedTimeframe}`
);

const predictionsResponse = await fetch(
  `${API_BASE_URL}/analysis/predictions?user_id=${userId}&metrics=focus_score,productivity_score,fatigue_level`
);

// æœŸå¾…ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
setAnalyticsData(timeseriesData.trends?.focus_trends || []);
setBehaviorPatterns(patternsData.patterns?.behavior_patterns || []);
setPredictiveInsights(predictionsData.predictions || []);
----

==== BehaviorInsights.tsx

[source,typescript]
----
// æœŸå¾…ã™ã‚‹è¡Œå‹•ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿
interface BehaviorTrend {
  timeframe: string;
  period_start?: string;
  period_end?: string;
  total_logs: number;
  focus_analysis?: {
    average_focus?: number;
    trend_direction?: 'up' | 'down' | 'stable';
    trend_percentage?: number;
    good_posture_percentage?: number;
    presence_rate?: number;
    smartphone_usage_rate?: number;
    total_sessions?: number;
  };
  anomalies?: unknown[];
  trend_summary?: unknown;
}

// æœŸå¾…ã™ã‚‹æ—¥æ¬¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
interface DailyInsight {
  target_date: string;
  logs_analyzed?: number;
  insights?: {
    focus_score?: number;
    productivity_score?: number;
    key_findings?: string[];
    improvement_areas?: string[];
  };
  summary?: {
    summary?: string;
  };
}
----

== ä¸¡è€…ã®å·®ç•°åˆ†æ

=== 1. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®é•ã„

==== æˆåŠŸæ™‚ã®ãƒ©ãƒƒãƒ”ãƒ³ã‚°

[cols="1,1,1"]
|===
|é …ç›®|ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰|ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…

|ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
|`{status: "success", data: {...}, timestamp: "..."}`
|ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹: `response.data`

|ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
|`{status: "error", error: "...", code: "..."}`
|HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹

|ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
|ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«ã§æä¾›
|ãƒ‡ãƒ¼ã‚¿é …ç›®å†…ã§æœŸå¾…
|===

==== ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

[source,typescript]
----
// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿéš›
{
  "status": "success",
  "data": {
    "focus_analysis": {
      "basic_statistics": {...}
    }
  }
}

// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…
timeseriesData.trends?.focus_trends  // data.focus_trends ã‚’ç›´æ¥æœŸå¾…
patternsData.patterns?.behavior_patterns  // data.behavior_patterns ã‚’ç›´æ¥æœŸå¾…
----

=== 2. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ä¸ä¸€è‡´

[cols="1,1,1"]
|===
|ãƒ‡ãƒ¼ã‚¿é …ç›®|ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰|ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…

|é›†ä¸­åº¦ãƒˆãƒ¬ãƒ³ãƒ‰
|`focus_analysis.trend_analysis`
|`trends.focus_trends`

|è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
|`pattern_recognition.behavioral_patterns`
|`patterns.behavior_patterns`

|äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿
|`predictions[]`
|`predictions[]` (ä¸€è‡´)

|ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
|`system_statistics`, `analysis_statistics`
|`system_statistics`, `analysis_statistics` (ä¸€è‡´)
|===

=== 3. å‹ã®ä¸ä¸€è‡´

==== é›†ä¸­åº¦ãƒ‡ãƒ¼ã‚¿

[cols="1,1,1"]
|===
|é …ç›®|ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰|ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…

|focus_score
|`focus_analysis.basic_statistics.mean` (0.0-1.0)
|`focus_score` (number)

|trend_direction
|`focus_analysis.trend_analysis.direction` ("up"/"down"/"stable")
|`trend_direction` ('up'/'down'/'stable')

|confidence
|`pattern_recognition.behavioral_patterns[].confidence`
|`confidence` (number)
|===

==== æ™‚é–“ãƒ‡ãƒ¼ã‚¿

[cols="1,1,1"]
|===
|é …ç›®|ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰|ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœŸå¾…

|æœŸé–“æŒ‡å®š
|`period_start`, `period_end` (ISO string)
|`period_start?`, `period_end?` (optional)

|ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
|`timestamp` (ISO string)
|`timestamp` (string)
|===

=== 4. WebSocketãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§

==== DetectionStatus

âœ… **ä¸€è‡´ã—ã¦ã„ã‚‹é …ç›®**
[source,typescript]
----
interface DetectionStatus {
  personDetected: boolean;        // âœ… ä¸€è‡´
  smartphoneDetected: boolean;    // âœ… ä¸€è‡´
  absenceTime: number;           // âœ… ä¸€è‡´
  smartphoneUseTime: number;     // âœ… ä¸€è‡´
  absenceAlert?: boolean;        // âœ… ä¸€è‡´
  smartphoneAlert?: boolean;     // âœ… ä¸€è‡´
}
----

==== æ‹¡å¼µãƒ‡ãƒ¼ã‚¿ï¼ˆbehavior_data, analysis_resultsï¼‰

âŒ **ä¸ä¸€è‡´ãƒ»æœªå®šç¾©**

[source,typescript]
----
// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒé€ä¿¡ï¼ˆmonitor.pyï¼‰
enhanced_status = {
  'behavior_data': behavior_data,
  'detection_data': current_detection_results,
  'analysis_results': self._generate_quick_insights(recent_logs)
}

// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã¯å¯¾å¿œã™ã‚‹å‹å®šç¾©ãŒä¸åœ¨
// AdvancedAnalyticsDashboard.tsx ã§ anyå‹ã§å—ä¿¡
socket.on('behavior_data', (data: any) => {...});
socket.on('analysis_results', (data: any) => {...});
----

== å•é¡Œç‚¹ã¨èª²é¡Œ

=== 1. é‡å¤§ãªå•é¡Œ

==== ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸æ•´åˆ

âŒ **å•é¡Œ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒãƒã‚¹ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã§ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹

[source,typescript]
----
// ç¾çŠ¶ï¼šå‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒé«˜ã„
setAnalyticsData(timeseriesData.trends?.focus_trends || []);

// æ­£ã—ãã¯
setAnalyticsData(timeseriesData.data?.focus_analysis?.basic_statistics || []);
----

==== ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ä¸ä¸€è‡´

âŒ **å•é¡Œ**: å¤šãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãŒä¸€è‡´ã—ã¦ã„ãªã„

[source,text]
----
æœŸå¾…: trends.focus_trends
å®Ÿéš›: data.focus_analysis

æœŸå¾…: patterns.behavior_patterns  
å®Ÿéš›: data.pattern_recognition.behavioral_patterns
----

=== 2. ä¸­ç¨‹åº¦ã®å•é¡Œ

==== å‹å®‰å…¨æ€§ã®æ¬ å¦‚

âš ï¸ **å•é¡Œ**: WebSocketã§é€ä¿¡ã•ã‚Œã‚‹æ‹¡å¼µãƒ‡ãƒ¼ã‚¿ã«å‹å®šç¾©ãŒãªã„

[source,typescript]
----
// anyå‹ã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹
socket.on('behavior_data', (data: any) => {...});
socket.on('analysis_results', (data: any) => {...});
----

==== ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã®ä¸åœ¨

âš ï¸ **å•é¡Œ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¸ã®å¤‰æ›å‡¦ç†ãŒä¸è¶³

=== 3. è»½å¾®ãªå•é¡Œ

==== ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸ä¸€è‡´

â„¹ï¸ **å•é¡Œ**: ä¸€éƒ¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«æ€§ãŒä¸ä¸€è‡´

== è§£æ±ºç­–ã®ææ¡ˆ

=== 1. çŸ­æœŸå¯¾å¿œï¼ˆå³åº§ã«å®Ÿè£…å¯èƒ½ï¼‰

==== ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›é–¢æ•°

[source,typescript]
----
// transformPerformanceData é–¢æ•°ã®æ‹¡å¼µä¾‹
const transformAnalyticsData = (backendData: BackendAnalyticsResponse): AnalyticsData[] => {
  return backendData.data?.focus_analysis?.basic_statistics?.map(stat => ({
    timestamp: stat.timestamp,
    focus_score: stat.mean,
    posture_score: stat.posture_score || 0.5,
    productivity_score: stat.productivity || 0.5,
    fatigue_level: 1.0 - stat.mean, // ç–²åŠ´åº¦ã¯é›†ä¸­åº¦ã®é€†
    distraction_count: stat.distraction_events || 0
  })) || [];
};

// ä½¿ç”¨ä¾‹
const processedData = transformAnalyticsData(timeseriesData);
setAnalyticsData(processedData);
----

==== TypeScriptå‹å®šç¾©ã®è¿½åŠ 

[source,typescript]
----
// WebSocketæ‹¡å¼µãƒ‡ãƒ¼ã‚¿ç”¨ã®å‹å®šç¾©
interface BehaviorDataUpdate {
  focus_trends: AnalyticsData[];
  current_status: {
    presence_status: string;
    smartphone_detected: boolean;
    focus_level: number;
    posture_score: number;
  };
  session_stats: {
    total_logs: number;
    present_time_ratio: number;
    smartphone_usage_ratio: number;
  };
}

interface AnalysisResultsUpdate {
  insights: string[];
  timestamp: string;
}
----

=== 2. ä¸­æœŸå¯¾å¿œï¼ˆAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±ä¸€ï¼‰

==== ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå½¢å¼ã®èª¿æ•´

ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®é¸æŠçš„å¤‰æ›´
[source,python]
----
# åˆ†æAPIã®ã¿ãƒ•ãƒ©ãƒƒãƒˆå½¢å¼ã§è¿”ã™
@basic_analysis_bp.route('/trends', methods=['GET'])
def get_behavior_trends():
    # ... å‡¦ç† ...
    return jsonify(trend_data)  # dataã‚­ãƒ¼ã§ãƒ©ãƒƒãƒ—ã—ãªã„
----

ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: äº’æ›æ€§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 
[source,python]
----
def format_for_frontend(data: Dict[str, Any], api_type: str) -> Dict[str, Any]:
    """ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘ã‘ã«ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’èª¿æ•´"""
    if api_type == 'trends':
        return {
            'trends': {
                'focus_trends': data.get('focus_analysis', {})
            }
        }
    # ... ä»–ã®å½¢å¼ ...
----

=== 3. é•·æœŸå¯¾å¿œï¼ˆçµ±ä¸€ä»•æ§˜ç­–å®šï¼‰

==== çµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒã®ç­–å®š

[source,yaml]
----
# api_schema.yaml
analytics_response:
  type: object
  properties:
    metadata:
      type: object
      properties:
        timeframe: string
        period_start: string (ISO 8601)
        period_end: string (ISO 8601)
        total_logs: integer
    analytics_data:
      type: array
      items:
        type: object
        properties:
          timestamp: string
          focus_score: number
          posture_score: number
          productivity_score: number
    patterns:
      type: array
      items:
        type: object
        properties:
          pattern_type: string
          confidence: number
          description: string
----

== æ¨å¥¨å®Ÿè£…é †åº

=== Phase 1: ç·Šæ€¥å¯¾å¿œï¼ˆ1-2æ—¥ï¼‰

1. âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒ‡ãƒ¼ã‚¿å¤‰æ›é–¢æ•°ã‚’è¿½åŠ 
2. âœ… TypeScriptå‹å®šç¾©ã‚’è¿½åŠ 
3. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¼·åŒ–

=== Phase 2: å®‰å®šåŒ–ï¼ˆ1é€±é–“ï¼‰

1. ğŸ”¶ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå½¢å¼ã®éƒ¨åˆ†èª¿æ•´
2. ğŸ”¶ WebSocketãƒ‡ãƒ¼ã‚¿å½¢å¼ã®çµ±ä¸€
3. ğŸ”¶ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¿½åŠ 

=== Phase 3: æœ€é©åŒ–ï¼ˆ2-3é€±é–“ï¼‰

1. ğŸ”· çµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒã®ç­–å®š
2. ğŸ”· APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
3. ğŸ”· å‹å®šç¾©ã®å®Œå…¨çµ±ä¸€

== çµè«–

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®åˆ†æãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã¯ä»¥ä¸‹ã®é‡è¦ãªå·®ç•°ãŒå­˜åœ¨ã—ã¾ã™ï¼š

1. **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸ä¸€è‡´**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœŸå¾…å€¤ã®é½Ÿé½¬
2. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®ä¸ä¸€è‡´**: å¤šãã®é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å‘½åãŒç•°ãªã‚‹
3. **å‹å®‰å…¨æ€§ã®æ¬ å¦‚**: WebSocketæ‹¡å¼µãƒ‡ãƒ¼ã‚¿ã«é©åˆ‡ãªå‹å®šç¾©ãŒãªã„

ã“ã‚Œã‚‰ã®å•é¡Œã¯æ®µéšçš„ãªå¯¾å¿œã«ã‚ˆã‚Šè§£æ±ºå¯èƒ½ã§ã‚ã‚Šã€çŸ­æœŸçš„ã«ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®å¤‰æ›é–¢æ•°ã«ã‚ˆã‚Šå¯¾å‡¦ã—ã€ä¸­é•·æœŸçš„ã«ã¯APIä»•æ§˜ã®çµ±ä¸€ã«ã‚ˆã‚Šæ ¹æœ¬è§£æ±ºã‚’å›³ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---
*æœ¬å ±å‘Šæ›¸ä½œæˆæ—¥: 2024-12-27*  
*èª¿æŸ»å¯¾è±¡ã‚³ãƒ¼ãƒ‰: backend/src/, frontend/src/*  
*è¦ç´„æº–æ‹ : project_rules/* 