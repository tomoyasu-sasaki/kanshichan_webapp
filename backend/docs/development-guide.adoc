= ğŸ› ï¸ ç›£è¦–ã¡ã‚ƒã‚“(KanshiChan) ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰
:toc: left
:toc-title: ç›®æ¬¡
:toclevels: 4
:numbered:
:source-highlighter: highlight.js
:icons: font
:doctype: book
:version: 2.0.0
:author: KanshiChan Development Team
:email: team@kanshichan.dev
:revnumber: 2.0
:revdate: {docdate}
:experimental:

== ğŸ“– æ¦‚è¦

KanshiChanï¼ˆç›£è¦–ã¡ã‚ƒã‚“ï¼‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™ºè€…å‘ã‘åŒ…æ‹¬çš„ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰å“è³ªä¿è¨¼ã¾ã§ã€åŠ¹ç‡çš„ã§ä¸€è²«æ€§ã®ã‚ã‚‹é–‹ç™ºã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

[NOTE]
====
ğŸ“‹ **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±**

* **å¯¾è±¡èª­è€…**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã€æ–°è¦å‚åŠ é–‹ç™ºè€…ã€æŠ€è¡“ãƒªãƒ¼ãƒ‰
* **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Python 3.9+ / Flask 2.3+ / AI/ML (YOLOv8, MediaPipe)
* **é–‹ç™ºæ‰‹æ³•**: ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã€ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º
* **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0.0 (AIæœ€é©åŒ–ãƒ»å›½éš›åŒ–å¯¾å¿œãƒ»TTSçµ±åˆç‰ˆ)
* **æœ€çµ‚æ›´æ–°**: {docdate}

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: <<backend-architecture>>, <<testing-strategy>>, <<configuration-guide>>
====

== ğŸ¯ é–‹ç™ºãƒ•ãƒ­ãƒ¼æ¦‚è¦

=== ğŸ’¡ é–‹ç™ºåŸå‰‡

==== KanshiChané–‹ç™ºå“²å­¦
* **å“è³ªå„ªå…ˆ**: å‹•ä½œã™ã‚‹ç¾ã—ã„ã‚³ãƒ¼ãƒ‰ã®è¿½æ±‚
* **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ AIå‡¦ç†ã¸ã®æœ€é©åŒ–
* **ä¿å®ˆæ€§**: æ˜ç¢ºã§ä¸€è²«æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰æ§‹é€ 
* **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ ã®å®¹æ˜“ã•
* **å›½éš›åŒ–å¯¾å¿œ**: å¤šè¨€èªç’°å¢ƒã§ã®é‹ç”¨

==== é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
[mermaid]
....
graph TB
    START[é–‹ç™ºé–‹å§‹] --> ISSUE[Issueç¢ºèªãƒ»ä½œæˆ]
    ISSUE --> BRANCH[æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒä½œæˆ]
    BRANCH --> ENV[é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—]
    ENV --> CODE[ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°]
    CODE --> TEST[ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ]
    TEST --> LINT[ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯]
    LINT --> COMMIT[ã‚³ãƒŸãƒƒãƒˆ]
    COMMIT --> PUSH[ãƒ—ãƒƒã‚·ãƒ¥]
    PUSH --> PR[ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ]
    PR --> REVIEW[ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼]
    REVIEW --> CI[CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³]
    CI --> MERGE[ãƒãƒ¼ã‚¸]
    MERGE --> DEPLOY[ãƒ‡ãƒ—ãƒ­ã‚¤]
    DEPLOY --> END[å®Œäº†]
    
    TEST -->|å¤±æ•—| CODE
    LINT -->|ã‚¨ãƒ©ãƒ¼| CODE
    REVIEW -->|ä¿®æ­£è¦æ±‚| CODE
    CI -->|å¤±æ•—| CODE
    
    classDef normal fill:#e6f3ff
    classDef decision fill:#fff3e6
    classDef success fill:#e6ffe6
    classDef error fill:#ffe6e6
    
    class START,ISSUE,BRANCH,ENV,CODE,COMMIT,PUSH,PR,MERGE,DEPLOY,END normal
    class TEST,LINT,REVIEW,CI decision
....

== ğŸš€ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

=== ğŸ’» å¿…è¦ãªç’°å¢ƒãƒ»ãƒ„ãƒ¼ãƒ«

==== ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
[cols="2,3,2", options="header"]
|===
|é …ç›® |è¦æ±‚äº‹é … |æ¨å¥¨
|**OS** |macOS 12+ / Ubuntu 20.04+ / Windows 10+ |macOS 13+ / Ubuntu 22.04+
|**Python** |3.9+ |3.11+
|**ãƒ¡ãƒ¢ãƒª** |8GB+ |16GB+
|**GPU** |CUDAå¯¾å¿œï¼ˆæ¨å¥¨ï¼‰ |RTX 3060+
|**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** |SSD 10GB+ |SSD 20GB+
|===

==== å¿…é ˆãƒ„ãƒ¼ãƒ«
```bash
# é–‹ç™ºãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³
âœ… Python 3.9+ (pyenvæ¨å¥¨)
âœ… Git 2.30+
âœ… Visual Studio Code / PyCharm
âœ… Docker (ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒç”¨)
âœ… Node.js 18+ (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æº)

# AI/MLç’°å¢ƒ
âœ… CUDA 11.8+ (GPUä½¿ç”¨æ™‚)
âœ… FFmpeg (éŸ³å£°å‡¦ç†)
âœ… OpenCVä¾å­˜é–¢ä¿‚
```

=== ğŸ”§ åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

==== 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³ã¨ä»®æƒ³ç’°å¢ƒ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/kanshichan/backend.git
cd backend

# Pythonä»®æƒ³ç’°å¢ƒä½œæˆï¼ˆvenvä½¿ç”¨ï¼‰
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# é–‹ç™ºç”¨è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
pip install -e .  # ã‚¨ãƒ‡ã‚£ã‚¿ãƒ–ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```

==== 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™

```bash
# è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p backend/config

# é–‹ç™ºç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cp config/config.yaml.example config/config.yaml

# ç’°å¢ƒå¤‰æ•°è¨­å®š
cat > .env << 'EOF'
KANSHICHAN_ENV=development
KANSHICHAN_DEBUG=true
KANSHICHAN_LOG_LEVEL=DEBUG
KANSHICHAN_GPU_ENABLED=auto
EOF
```

==== 3. AIãƒ¢ãƒ‡ãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# YOLOãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾å¿œï¼‰
python -c "from ultralytics import YOLO; YOLO('yolov8n.pt')"

# MediaPipeã¯è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
# TTSãƒ¢ãƒ‡ãƒ«ï¼ˆZonosï¼‰ã¯åˆå›å®Ÿè¡Œæ™‚ã«è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

==== 4. é–‹ç™ºç’°å¢ƒå‹•ä½œç¢ºèª

```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python -m pytest tests/ -v

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd backend
python -m src.web.app

# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/api/status
```

=== ğŸ”¨ IDEãƒ»ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®š

==== Visual Studio Codeæ¨å¥¨è¨­å®š

```json
// .vscode/settings.json
{
    "python.defaultInterpreter": "./venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.linting.mypyEnabled": true,
    "python.formatting.provider": "black",
    "python.formatting.blackArgs": ["--line-length", "88"],
    "python.sortImports.args": ["--profile", "black"],
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    },
    "files.exclude": {
        "**/__pycache__": true,
        "**/.pytest_cache": true,
        "**/*.pyc": true
    }
}
```

==== æ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½

```bash
# VS Codeæ‹¡å¼µæ©Ÿèƒ½
âœ… Python (Microsoft)
âœ… Pylance (Microsoft)
âœ… Black Formatter
âœ… isort
âœ… GitLens
âœ… YAML
âœ… AsciiDoc
âœ… Better Comments
```

== ğŸ“ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ï¼ˆè©³ç´°ç‰ˆï¼‰

=== ğŸ¨ Python ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«

==== åŸºæœ¬è¦ç´„ï¼ˆPEP 8 + Blackï¼‰

```python
# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ä¾‹
"""
ç‰©ä½“æ¤œå‡ºå™¨ - çµ±åˆç‰©ä½“æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 

YOLOv8ã¨MediaPipeã‚’çµ±åˆã—ãŸé«˜æ€§èƒ½ç‰©ä½“æ¤œå‡ºæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
AIæœ€é©åŒ–ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚’çµ„ã¿è¾¼ã‚“ã ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã«å¯¾å¿œã€‚

Author: KanshiChan Development Team
Version: 2.0.0
"""

import logging
from typing import Dict, List, Optional, Union, Any
from dataclasses import dataclass
import asyncio

import cv2
import numpy as np
from ultralytics import YOLO

from utils.logger import setup_logger
from utils.exceptions import wrap_exception, ModelError

logger = setup_logger(__name__)

# å®šæ•°å®šç¾©
DEFAULT_CONFIDENCE_THRESHOLD = 0.5
MAX_DETECTION_COUNT = 10
YOLO_MODEL_PATH = "yolov8n.pt"
```

==== å‘½åè¦å‰‡

[cols="2,3,3", options="header"]
|===
|å¯¾è±¡ |è¦å‰‡ |ä¾‹
|**å¤‰æ•°** |snake_case |`detection_results`, `frame_count`
|**é–¢æ•°** |snake_case |`detect_objects()`, `process_frame()`
|**ã‚¯ãƒ©ã‚¹** |PascalCase |`ObjectDetector`, `AIOptimizer`
|**å®šæ•°** |UPPER_SNAKE_CASE |`DEFAULT_FPS`, `MAX_MEMORY_MB`
|**ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ** |_leading_underscore |`_internal_method()`, `_config`
|**ãƒ•ã‚¡ã‚¤ãƒ«** |snake_case |`object_detector.py`, `ai_optimizer.py`
|===

==== å‹ãƒ’ãƒ³ãƒˆï¼ˆå¿…é ˆï¼‰

```python
from typing import Dict, List, Optional, Union, Any, Tuple, Callable

# åŸºæœ¬çš„ãªå‹ãƒ’ãƒ³ãƒˆ
def detect_objects(self, frame: np.ndarray) -> Dict[str, Any]:
    """å‹ãƒ’ãƒ³ãƒˆä»˜ãé–¢æ•°å®šç¾©"""
    pass

# è¤‡åˆå‹ã®ä½¿ç”¨
class DetectionResult:
    def __init__(self, 
                 confidence: float,
                 bbox: Tuple[int, int, int, int],
                 class_name: str,
                 metadata: Optional[Dict[str, Any]] = None) -> None:
        self.confidence = confidence
        self.bbox = bbox
        self.class_name = class_name
        self.metadata = metadata or {}

# ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°å‹
OnDetectionCallback = Callable[[Dict[str, Any]], None]

def register_callback(self, callback: OnDetectionCallback) -> None:
    """ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™»éŒ²"""
    pass
```

=== ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

==== ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
class ObjectDetectorService:
    """ç‰©ä½“æ¤œå‡ºã‚µãƒ¼ãƒ“ã‚¹
    
    çµ±åˆç‰©ä½“æ¤œå‡ºæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã€‚
    ä¾å­˜é–¢ä¿‚æ³¨å…¥ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’çµ±åˆã€‚
    """
    
    def __init__(self, 
                 config_manager: Optional[ConfigManager] = None,
                 ai_optimizer: Optional[AIOptimizer] = None,
                 memory_manager: Optional[MemoryManager] = None) -> None:
        """ä¾å­˜é–¢ä¿‚æ³¨å…¥ã«ã‚ˆã‚‹åˆæœŸåŒ–"""
        try:
            self.config_manager = config_manager
            self.ai_optimizer = ai_optimizer or AIOptimizer(config_manager)
            self.memory_manager = memory_manager or MemoryManager(config_manager)
            
            self._model = None
            self._last_detection_time = 0
            self._performance_stats = {}
            
            logger.info("ObjectDetectorService initialized successfully")
            
        except Exception as e:
            error = wrap_exception(
                e, ModelError,
                "Failed to initialize ObjectDetectorService",
                error_code="DETECTOR_INIT_001",
                details={'config_available': config_manager is not None}
            )
            logger.error(f"Initialization error: {error.to_dict()}")
            raise error
    
    async def detect_objects_async(self, frame: np.ndarray) -> Dict[str, Any]:
        """éåŒæœŸç‰©ä½“æ¤œå‡ºå‡¦ç†"""
        try:
            # AIæœ€é©åŒ–çµ±åˆ
            if self.ai_optimizer:
                optimized_result = await self.ai_optimizer.optimize_yolo_inference_async(
                    self._model, frame
                )
                if optimized_result is None:  # ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—
                    return self._create_empty_detection_result()
                
            # é€šå¸¸ã®æ¤œå‡ºå‡¦ç†
            result = await self._perform_detection(frame)
            
            # ãƒ¡ãƒ¢ãƒªç®¡ç†
            if self.memory_manager:
                self.memory_manager.update_frame_cache(frame, result)
            
            return result
            
        except Exception as e:
            error = wrap_exception(
                e, DetectionError,
                "Object detection failed",
                error_code="DETECT_001",
                details={
                    'frame_shape': frame.shape if frame is not None else None,
                    'model_loaded': self._model is not None
                }
            )
            logger.error(f"Detection error: {error.to_dict()}")
            raise error
```

==== ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
from utils.exceptions import wrap_exception, ModelError, DetectionError

def robust_model_operation(self, operation_data: Any) -> Any:
    """å …ç‰¢ãªãƒ¢ãƒ‡ãƒ«æ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³"""
    try:
        # å‰å‡¦ç†ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if not self._validate_input(operation_data):
            raise ValidationError("Invalid input data")
        
        # ãƒ¡ã‚¤ãƒ³å‡¦ç†
        result = self._perform_operation(operation_data)
        
        # å¾Œå‡¦ç†æ¤œè¨¼
        if not self._validate_result(result):
            raise DetectionError("Invalid detection result")
            
        return result
        
    except ValidationError as e:
        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯å†ç™ºç”Ÿ
        logger.warning(f"Input validation failed: {e}")
        raise
        
    except ModelError as e:
        # ãƒ¢ãƒ‡ãƒ«ã‚¨ãƒ©ãƒ¼ã¯è©³ç´°åŒ–ã—ã¦å†ç™ºç”Ÿ
        enhanced_error = wrap_exception(
            e, ModelError,
            f"Model operation failed: {e.message}",
            error_code="MODEL_OP_001",
            details={
                'operation_type': 'detection',
                'input_type': type(operation_data).__name__,
                'fallback_available': True
            }
        )
        logger.error(f"Model operation error: {enhanced_error.to_dict()}")
        
        # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
        return self._fallback_operation(operation_data)
        
    except Exception as e:
        # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã¯åŒ…è£…
        error = wrap_exception(
            e, DetectionError,
            "Unexpected error in model operation",
            error_code="UNKNOWN_001",
            details={
                'operation_data_type': type(operation_data).__name__,
                'stack_trace': True
            }
        )
        logger.error(f"Unexpected error: {error.to_dict()}", exc_info=True)
        raise error
```

=== ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

==== Docstringè¦ç´„ï¼ˆGoogle Styleï¼‰

```python
def optimize_yolo_inference(self, 
                          model: YOLO, 
                          frame: np.ndarray,
                          confidence_threshold: float = 0.5) -> Optional[Dict[str, Any]]:
    """YOLOæ¨è«–ã®æœ€é©åŒ–å‡¦ç†
    
    ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®šã€GPUæœ€é©åŒ–ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚’çµ±åˆã—ãŸ
    YOLOæ¨è«–å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«å¿œã˜ã¦è‡ªå‹•çš„ã«
    å‡¦ç†ãƒ¬ãƒ™ãƒ«ã‚’èª¿æ•´ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚’ç¶­æŒã—ã¾ã™ã€‚
    
    Args:
        model: åˆæœŸåŒ–æ¸ˆã¿YOLOãƒ¢ãƒ‡ãƒ«
        frame: å…¥åŠ›ç”»åƒãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆBGRå½¢å¼ã€uint8ï¼‰
        confidence_threshold: æ¤œå‡ºä¿¡é ¼åº¦é–¾å€¤ï¼ˆ0.0-1.0ï¼‰
        
    Returns:
        æ¤œå‡ºçµæœè¾æ›¸ã€‚ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—æ™‚ã¯Noneã€‚
        å½¢å¼: {
            'detections': List[Dict],
            'inference_time': float,
            'frame_id': int,
            'performance_stats': Dict
        }
        
    Raises:
        ModelError: YOLOæ¨è«–ã«å¤±æ•—ã—ãŸå ´åˆ
        OptimizationError: æœ€é©åŒ–å‡¦ç†ã«å¤±æ•—ã—ãŸå ´åˆ
        ValidationError: å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç„¡åŠ¹ãªå ´åˆ
        
    Example:
        >>> detector = ObjectDetector()
        >>> frame = cv2.imread('test.jpg')
        >>> result = detector.optimize_yolo_inference(model, frame)
        >>> if result:
        ...     print(f"Detected {len(result['detections'])} objects")
        
    Note:
        - ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—ã¯AIOptimizerã®è¨­å®šã«å¾“ã„ã¾ã™
        - GPUä½¿ç”¨ä¸å¯æ™‚ã¯è‡ªå‹•çš„ã«CPUã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆã¯è‡ªå‹•çš„ã«è¨˜éŒ²ã•ã‚Œã¾ã™
        
    Since:
        v2.0.0 - AIæœ€é©åŒ–çµ±åˆç‰ˆ
    """
    pass
```

== ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ»æ‰‹æ³•

=== ğŸ¯ ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

[mermaid]
....
graph TB
    subgraph "ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰"
        E2E[E2Eãƒ†ã‚¹ãƒˆ<br/>ğŸ” çµ±åˆã‚·ãƒŠãƒªã‚ª<br/>å°‘æ•°ãƒ»é‡è¦æ©Ÿèƒ½ã®ã¿]
        INTEGRATION[çµ±åˆãƒ†ã‚¹ãƒˆ<br/>ğŸ”— ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“é€£æº<br/>APIãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹]
        UNIT[å˜ä½“ãƒ†ã‚¹ãƒˆ<br/>âš¡ å€‹åˆ¥é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹<br/>é«˜é€Ÿãƒ»å¤§é‡ãƒ»è©³ç´°]
    end
    
    E2E --> INTEGRATION
    INTEGRATION --> UNIT
    
    classDef e2e fill:#ffebee
    classDef integration fill:#f3e5f5
    classDef unit fill:#e8f5e8
    
    class E2E e2e
    class INTEGRATION integration
    class UNIT unit
....

=== ğŸ”¬ å˜ä½“ãƒ†ã‚¹ãƒˆ

==== pyteståŸºæœ¬è¨­å®š

```python
# conftest.py
import pytest
import numpy as np
from unittest.mock import Mock, patch
from src.utils.config_manager import ConfigManager
from src.core.ai_optimizer import AIOptimizer

@pytest.fixture
def sample_frame():
    """ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ """
    return np.random.randint(0, 255, (480, 640, 3), dtype=np.uint8)

@pytest.fixture
def mock_config():
    """ãƒ¢ãƒƒã‚¯è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"""
    config = Mock(spec=ConfigManager)
    config.get.side_effect = lambda key, default=None: {
        'ai_optimization.enabled': True,
        'ai_optimization.target_fps': 15.0,
        'yolo.confidence_threshold': 0.5
    }.get(key, default)
    return config

@pytest.fixture
def ai_optimizer(mock_config):
    """AIOptimizer ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return AIOptimizer(mock_config)

# ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ä¾‹
class TestObjectDetector:
    """ç‰©ä½“æ¤œå‡ºå™¨ã®ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹"""
    
    def test_initialization_success(self, mock_config):
        """æ­£å¸¸åˆæœŸåŒ–ã®ãƒ†ã‚¹ãƒˆ"""
        detector = ObjectDetector(mock_config)
        assert detector.config_manager is mock_config
        assert detector.ai_optimizer is not None
        
    def test_initialization_without_config(self):
        """è¨­å®šãªã—åˆæœŸåŒ–ã®ãƒ†ã‚¹ãƒˆ"""
        detector = ObjectDetector()
        assert detector.config_manager is None
        assert detector.ai_optimizer is not None  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåˆæœŸåŒ–
        
    @patch('src.core.object_detector.YOLO')
    def test_detect_objects_success(self, mock_yolo, sample_frame, mock_config):
        """ç‰©ä½“æ¤œå‡ºæˆåŠŸã®ãƒ†ã‚¹ãƒˆ"""
        # ãƒ¢ãƒƒã‚¯è¨­å®š
        mock_model = Mock()
        mock_yolo.return_value = mock_model
        mock_model.predict.return_value = [Mock(boxes=Mock(data=[]))]
        
        detector = ObjectDetector(mock_config)
        result = detector.detect_objects(sample_frame)
        
        assert 'detections' in result
        assert 'inference_time' in result
        assert isinstance(result['detections'], list)
        
    def test_detect_objects_with_invalid_frame(self, mock_config):
        """ç„¡åŠ¹ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã®æ¤œå‡ºãƒ†ã‚¹ãƒˆ"""
        detector = ObjectDetector(mock_config)
        
        with pytest.raises(ValidationError) as exc_info:
            detector.detect_objects(None)
            
        assert "Invalid frame" in str(exc_info.value)
        
    @patch('src.core.object_detector.logger')
    def test_error_logging(self, mock_logger, mock_config):
        """ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆ"""
        detector = ObjectDetector(mock_config)
        
        with patch.object(detector, '_perform_detection', side_effect=Exception("Test error")):
            with pytest.raises(DetectionError):
                detector.detect_objects(np.zeros((100, 100, 3), dtype=np.uint8))
                
        mock_logger.error.assert_called()
```

==== AI/MLç‰¹åŒ–ãƒ†ã‚¹ãƒˆ

```python
class TestAIComponents:
    """AI/ML ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå°‚ç”¨ãƒ†ã‚¹ãƒˆ"""
    
    def test_yolo_model_loading(self):
        """YOLOãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ"""
        with patch('ultralytics.YOLO') as mock_yolo:
            detector = ObjectDetector()
            detector._load_yolo_model('yolov8n.pt')
            mock_yolo.assert_called_once_with('yolov8n.pt')
            
    def test_mediapipe_initialization(self):
        """MediaPipeåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ"""
        with patch('mediapipe.solutions.pose.Pose') as mock_pose:
            detector = ObjectDetector()
            detector._initialize_mediapipe()
            mock_pose.assert_called_once()
            
    def test_ai_optimization_frame_skip(self, ai_optimizer, sample_frame):
        """ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ"""
        with patch.object(ai_optimizer, '_should_skip_frame', return_value=True):
            result = ai_optimizer.optimize_yolo_inference(Mock(), sample_frame)
            assert result is None  # ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—æ™‚
            
    def test_performance_monitoring(self, ai_optimizer, sample_frame):
        """ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ†ã‚¹ãƒˆ"""
        with patch.object(ai_optimizer, 'performance_monitor') as mock_monitor:
            ai_optimizer.optimize_yolo_inference(Mock(), sample_frame)
            mock_monitor.record_inference_time.assert_called()
```

=== ğŸ”— çµ±åˆãƒ†ã‚¹ãƒˆ

```python
# test_integration.py
import requests
import pytest
from src.web.app import create_app

class TestAPIIntegration:
    """APIçµ±åˆãƒ†ã‚¹ãƒˆ"""
    
    @pytest.fixture
    def client(self):
        """ãƒ†ã‚¹ãƒˆç”¨Flaskã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
        app = create_app(testing=True)
        with app.test_client() as client:
            yield client
            
    def test_health_check_endpoint(self, client):
        """ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
        response = client.get('/api/status')
        assert response.status_code == 200
        data = response.get_json()
        assert 'status' in data
        assert data['status'] == 'running'
        
    def test_detection_endpoint(self, client):
        """æ¤œå‡ºã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ"""
        # ãƒ†ã‚¹ãƒˆç”»åƒãƒ‡ãƒ¼ã‚¿
        test_image = np.random.randint(0, 255, (100, 100, 3), dtype=np.uint8)
        
        with patch('src.core.object_detector.ObjectDetector.detect_objects') as mock_detect:
            mock_detect.return_value = {
                'detections': [],
                'inference_time': 0.1,
                'frame_id': 1
            }
            
            response = client.post('/api/detect', 
                                 data={'frame': test_image.tobytes()})
            assert response.status_code == 200
```

== ğŸ› ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

=== ğŸ“Š ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒãƒƒã‚°

==== æ§‹é€ åŒ–ãƒ­ã‚°æ´»ç”¨

```python
from utils.logger import setup_logger, log_performance_metric

logger = setup_logger(__name__)

def debug_detection_process(self, frame: np.ndarray) -> Dict[str, Any]:
    """ãƒ‡ãƒãƒƒã‚°ç”¨æ¤œå‡ºå‡¦ç†"""
    import time
    start_time = time.time()
    
    # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ä»˜ããƒ­ã‚°
    logger.debug("Starting detection process", extra={
        'frame_shape': frame.shape,
        'frame_dtype': str(frame.dtype),
        'memory_usage_mb': self._get_memory_usage(),
        'gpu_available': torch.cuda.is_available()
    })
    
    try:
        result = self._perform_detection(frame)
        
        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
        inference_time = time.time() - start_time
        log_performance_metric(
            logger, 
            'detection_inference_time', 
            inference_time,
            extra_data={
                'frame_id': self._frame_counter,
                'detection_count': len(result.get('detections', [])),
                'model_type': 'yolo_v8'
            }
        )
        
        return result
        
    except Exception as e:
        logger.error("Detection failed", extra={
            'error_type': type(e).__name__,
            'frame_shape': frame.shape,
            'processing_time': time.time() - start_time
        }, exc_info=True)
        raise
```

==== ãƒ‡ãƒãƒƒã‚°ç”¨è¨­å®š

```yaml
# config/debug.yaml
app:
  debug: true
  logging:
    level: "DEBUG"
    enable_console_output: true
    enable_file_output: true
    file_level: "DEBUG"
    suppress_frequent_logs: false  # ãƒ‡ãƒãƒƒã‚°æ™‚ã¯æŠ‘åˆ¶ç„¡åŠ¹

# ãƒ‡ãƒãƒƒã‚°ç”¨AIè¨­å®š
yolo:
  device:
    preferred: "cpu"  # ãƒ‡ãƒãƒƒã‚°æ™‚ã¯CPUä½¿ç”¨
    
ai_optimization:
  enabled: false  # æœ€é©åŒ–ç„¡åŠ¹ã§ãƒ‡ãƒãƒƒã‚°
  
performance:
  system:
    enabled: true
    detailed_metrics: true  # è©³ç´°ãƒ¡ãƒˆãƒªã‚¯ã‚¹æœ‰åŠ¹
```

=== ğŸ” å¯¾è©±çš„ãƒ‡ãƒãƒƒã‚°

==== VS Code Debuggerè¨­å®š

```json
// .vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "KanshiChan Backend Debug",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/backend/src/web/app.py",
            "console": "integratedTerminal",
            "env": {
                "KANSHICHAN_ENV": "development",
                "KANSHICHAN_DEBUG": "true",
                "PYTHONPATH": "${workspaceFolder}/backend/src"
            },
            "args": [],
            "justMyCode": false
        },
        {
            "name": "Test Single File",
            "type": "python",
            "request": "launch",
            "module": "pytest",
            "args": ["${file}", "-v", "-s"],
            "console": "integratedTerminal",
            "env": {
                "PYTHONPATH": "${workspaceFolder}/backend"
            }
        }
    ]
}
```

==== IPython/Jupyteræ´»ç”¨

```python
# debug_notebook.py - Jupyterç”¨ãƒ‡ãƒãƒƒã‚°ã‚»ãƒ«
%load_ext autoreload
%autoreload 2

import sys
sys.path.append('../backend/src')

from core.object_detector import ObjectDetector
from utils.config_manager import ConfigManager
import cv2
import numpy as np

# ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
config = ConfigManager('config/debug.yaml')
detector = ObjectDetector(config)

# ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
test_frame = np.random.randint(0, 255, (480, 640, 3), dtype=np.uint8)

# ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒãƒƒã‚°
result = detector.detect_objects(test_frame)
print(f"Detection result: {result}")

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
%timeit detector.detect_objects(test_frame)
```

=== ğŸ”§ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°

==== cProfileä½¿ç”¨

```python
import cProfile
import pstats
from src.core.object_detector import ObjectDetector

def profile_detection():
    """æ¤œå‡ºå‡¦ç†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°"""
    detector = ObjectDetector()
    frame = np.random.randint(0, 255, (480, 640, 3), dtype=np.uint8)
    
    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
    profiler = cProfile.Profile()
    profiler.enable()
    
    for _ in range(100):  # 100å›å®Ÿè¡Œ
        detector.detect_objects(frame)
    
    profiler.disable()
    
    # çµæœä¿å­˜ãƒ»è¡¨ç¤º
    stats = pstats.Stats(profiler)
    stats.sort_stats('cumulative')
    stats.print_stats(20)  # ä¸Šä½20é–¢æ•°
    stats.dump_stats('detection_profile.prof')

if __name__ == "__main__":
    profile_detection()
```

== ğŸ‘¥ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹

=== ğŸ”„ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

[mermaid]
....
graph LR
    PR[ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ] --> AUTO[è‡ªå‹•ãƒã‚§ãƒƒã‚¯]
    AUTO --> ASSIGN[ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼å‰²ã‚Šå½“ã¦]
    ASSIGN --> REVIEW1[åˆå›ãƒ¬ãƒ“ãƒ¥ãƒ¼]
    REVIEW1 --> FEEDBACK{ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯}
    FEEDBACK -->|ä¿®æ­£å¿…è¦| FIX[ä¿®æ­£ä½œæ¥­]
    FIX --> REVIEW2[å†ãƒ¬ãƒ“ãƒ¥ãƒ¼]
    REVIEW2 --> FEEDBACK
    FEEDBACK -->|æ‰¿èª| APPROVE[æ‰¿èª]
    APPROVE --> MERGE[ãƒãƒ¼ã‚¸]
    
    classDef normal fill:#e6f3ff
    classDef decision fill:#fff3e6
    classDef success fill:#e6ffe6
    
    class PR,AUTO,ASSIGN,REVIEW1,FIX,REVIEW2,MERGE normal
    class FEEDBACK decision
    class APPROVE success
....

=== ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

==== ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```yaml
# ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
code_quality:
  style:
    - [ ] Black ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé©ç”¨æ¸ˆã¿
    - [ ] isort ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ•´ç†æ¸ˆã¿
    - [ ] flake8 ã‚¨ãƒ©ãƒ¼è§£æ¶ˆæ¸ˆã¿
    - [ ] mypy å‹ãƒã‚§ãƒƒã‚¯é€šé
    
  naming:
    - [ ] å¤‰æ•°ãƒ»é–¢æ•°åãŒæ„å›³ã‚’æ˜ç¢ºã«è¡¨ç¾
    - [ ] ã‚¯ãƒ©ã‚¹åãŒPascalCase
    - [ ] å®šæ•°ãŒUPPER_SNAKE_CASE
    - [ ] ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã«é©åˆ‡ãªã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢
    
  documentation:
    - [ ] å…¬é–‹APIå…¨ã¦ã«docstring
    - [ ] è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã‚³ãƒ¡ãƒ³ãƒˆ
    - [ ] å‹ãƒ’ãƒ³ãƒˆé©åˆ‡ã«è¨˜è¿°
    - [ ] ä¾‹å¤–å‡¦ç†ã®èª¬æ˜æ˜ç¢º
    
architecture:
  design:
    - [ ] å˜ä¸€è²¬ä»»åŸå‰‡ã®éµå®ˆ
    - [ ] é©åˆ‡ãªä¾å­˜é–¢ä¿‚æ³¨å…¥
    - [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
    - [ ] ãƒ­ã‚°å‡ºåŠ›é©åˆ‡ã«é…ç½®
    
  performance:
    - [ ] AIæœ€é©åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ä½¿ç”¨
    - [ ] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–å®Ÿè£…
    - [ ] ä¸è¦ãªè¨ˆç®—å‡¦ç†æ’é™¤
    - [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥é©ç”¨

testing:
  coverage:
    - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š
    - [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…
    - [ ] ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…
    - [ ] ãƒ¢ãƒƒã‚¯é©åˆ‡ã«ä½¿ç”¨
    
  integration:
    - [ ] APIçµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…
    - [ ] ä¸»è¦ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª
    - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```

==== AI/MLç‰¹åŒ–ãƒ¬ãƒ“ãƒ¥ãƒ¼

```yaml
ai_ml_review:
  model_usage:
    - [ ] ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    - [ ] GPU/CPUè‡ªå‹•åˆ‡ã‚Šæ›¿ãˆå®Ÿè£…
    - [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
    - [ ] æ¨è«–æ™‚é–“æ¸¬å®š
    
  optimization:
    - [ ] ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—é©ç”¨
    - [ ] ãƒãƒƒãƒå‡¦ç†æ¤œè¨
    - [ ] å‰å‡¦ç†æœ€é©åŒ–
    - [ ] å¾Œå‡¦ç†åŠ¹ç‡åŒ–
    
  accuracy:
    - [ ] é–¾å€¤è¨­å®šã®å¦¥å½“æ€§
    - [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†é©åˆ‡æ€§
    - [ ] æ¤œå‡ºçµæœæ¤œè¨¼
    - [ ] èª¤æ¤œå‡ºå¯¾ç­–å®Ÿè£…
```

=== ğŸ’¬ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆä¾‹

```python
# âŒ æ‚ªã„ä¾‹
def detect(frame):  # å‹ãƒ’ãƒ³ãƒˆãªã—ã€docstringãªã—
    result = model(frame)  # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã—
    return result

# âœ… è‰¯ã„ä¾‹
def detect_objects(self, frame: np.ndarray) -> Dict[str, Any]:
    """ãƒ•ãƒ¬ãƒ¼ãƒ å†…ã®ç‰©ä½“ã‚’æ¤œå‡º
    
    Args:
        frame: BGRå½¢å¼ã®å…¥åŠ›ç”»åƒ
        
    Returns:
        æ¤œå‡ºçµæœè¾æ›¸
        
    Raises:
        ValidationError: ãƒ•ãƒ¬ãƒ¼ãƒ ãŒç„¡åŠ¹ãªå ´åˆ
        ModelError: æ¨è«–ã«å¤±æ•—ã—ãŸå ´åˆ
    """
    try:
        # å…¥åŠ›æ¤œè¨¼
        if frame is None or frame.size == 0:
            raise ValidationError("Invalid frame")
            
        # AIæœ€é©åŒ–çµ±åˆ
        result = self.ai_optimizer.optimize_yolo_inference(self.model, frame)
        if result is None:  # ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—
            return self._create_empty_result()
            
        return result
        
    except Exception as e:
        error = wrap_exception(e, DetectionError, "Detection failed")
        logger.error(f"Detection error: {error.to_dict()}")
        raise error
```

== ğŸŒ¿ Gité‹ç”¨ãƒ«ãƒ¼ãƒ«

=== ğŸ”€ ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

[mermaid]
....
gitgraph
    commit id: "Initial"
    branch develop
    checkout develop
    commit id: "Dev Setup"
    
    branch feature/detection-optimization
    checkout feature/detection-optimization
    commit id: "Add AI optimizer"
    commit id: "Add tests"
    commit id: "Fix performance"
    
    checkout develop
    merge feature/detection-optimization
    commit id: "Merge optimization"
    
    branch feature/tts-integration
    checkout feature/tts-integration
    commit id: "Add TTS service"
    commit id: "Add emotions"
    
    checkout develop
    merge feature/tts-integration
    commit id: "Merge TTS"
    
    checkout main
    merge develop
    commit id: "Release v2.0.0"
    tag: "v2.0.0"
....

=== ğŸ“ ã‚³ãƒŸãƒƒãƒˆè¦ç´„

==== Conventional Commitså½¢å¼

```bash
# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
<type>(<scope>): <description>

[optional body]

[optional footer(s)]

# ä¾‹
feat(detection): add AI optimization for YOLO inference
fix(tts): resolve audio playback issue on macOS
docs(api): update REST API documentation
test(core): add unit tests for object detector
perf(memory): optimize frame caching strategy
refactor(utils): simplify exception handling
style(format): apply black formatting
ci(github): update workflow for Python 3.11
```

==== Typeå®šç¾©

[cols="2,3,2", options="header"]
|===
|Type |èª¬æ˜ |ä¾‹
|**feat** |æ–°æ©Ÿèƒ½è¿½åŠ  |`feat(ai): add pose detection`
|**fix** |ãƒã‚°ä¿®æ­£ |`fix(camera): resolve frame capture issue`
|**docs** |ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |`docs(api): update endpoint spec`
|**test** |ãƒ†ã‚¹ãƒˆ |`test(unit): add detector tests`
|**refactor** |ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° |`refactor(core): simplify detection flow`
|**perf** |ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ |`perf(gpu): optimize CUDA memory usage`
|**style** |ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ |`style: apply black formatting`
|**ci** |CI/CD |`ci: add automated testing`
|**chore** |é›‘å‹™ |`chore: update dependencies`
|===

=== ğŸ”§ ãƒ–ãƒ©ãƒ³ãƒé‹ç”¨

```bash
# æ©Ÿèƒ½é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/ai-optimization-v2
git checkout -b bugfix/camera-initialization-error
git checkout -b docs/development-guide

# ä½œæ¥­ã¨ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat(optimization): implement frame skipping logic"

# ãƒ—ãƒƒã‚·ãƒ¥ã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
git push origin feature/ai-optimization-v2
# GitHub ã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

# ãƒãƒ¼ã‚¸å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
git checkout develop
git pull origin develop
git branch -d feature/ai-optimization-v2
```

== âœ… å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

=== ğŸ¯ é–‹ç™ºå“è³ªä¿è¨¼

==== äº‹å‰ãƒã‚§ãƒƒã‚¯ï¼ˆé–‹ç™ºè€…ï¼‰

```bash
# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
make lint          # flake8, mypy, black
make test          # pytestå®Ÿè¡Œ
make coverage      # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
make security      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

# ã¾ãŸã¯çµ±åˆã‚³ãƒãƒ³ãƒ‰
make check-all     # å…¨ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
```

==== Makefileè¨­å®šä¾‹

```makefile
# Makefile
.PHONY: lint test coverage security check-all

# ä»®æƒ³ç’°å¢ƒæœ‰åŠ¹åŒ–
VENV = venv/bin/activate

lint:
	source $(VENV) && black --check src/ tests/

test:
	source $(VENV) && pytest tests/ -v --tb=short

coverage:
	source $(VENV) && pytest tests/ --cov=src --cov-report=html --cov-report=term

security:
	source $(VENV) && bandit -r src/
	source $(VENV) && safety check

check-all: lint test coverage security
	@echo "âœ… All quality checks passed!"

# é–‹ç™ºç”¨
dev-setup:
	python -m venv venv
	source $(VENV) && pip install -r requirements.txt
	source $(VENV) && pip install -e .

run-dev:
	source $(VENV) && cd backend && python -m src.web.app

clean:
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	rm -rf .coverage htmlcov/ .pytest_cache/
```

=== ğŸ“Š å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹

==== ç›®æ¨™å“è³ªæŒ‡æ¨™

[cols="2,2,2,2", options="header"]
|===
|æŒ‡æ¨™ |æœ€ä½åŸºæº– |ç›®æ¨™ |æ–¹æ³•
|**ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** |70% |80%+ |pytest-cov
|**å‹ãƒ’ãƒ³ãƒˆé©ç”¨** |90% |95%+ |mypy
|**ã‚³ãƒ¼ãƒ‰è¤‡é›‘åº¦** |<10 |<7 |flake8-complexity
|**é‡è¤‡ç‡** |<5% |<3% |flake8-duplicate
|**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** |High/Critical 0 |0 |bandit
|**ä¾å­˜é–¢ä¿‚** |è„†å¼±æ€§ 0 |0 |safety
|===

==== ç¶™ç¶šçš„ç›£è¦–

```python
# quality_metrics.py - å“è³ªæŒ‡æ¨™ç›£è¦–
import subprocess
import json
from typing import Dict, Any

def collect_quality_metrics() -> Dict[str, Any]:
    """å“è³ªæŒ‡æ¨™ã‚’åé›†"""
    metrics = {}
    
    # ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
    coverage_result = subprocess.run(
        ['pytest', '--cov=src', '--cov-report=json'],
        capture_output=True, text=True
    )
    if coverage_result.returncode == 0:
        with open('coverage.json') as f:
            coverage_data = json.load(f)
            metrics['test_coverage'] = coverage_data['totals']['percent_covered']
    
    # å‹ãƒã‚§ãƒƒã‚¯çµæœ
    mypy_result = subprocess.run(
        ['mypy', 'src/', '--json-report', 'mypy_report.json'],
        capture_output=True, text=True
    )
    metrics['type_check_pass'] = mypy_result.returncode == 0
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
    bandit_result = subprocess.run(
        ['bandit', '-r', 'src/', '-f', 'json'],
        capture_output=True, text=True
    )
    if bandit_result.returncode in [0, 1]:  # 0=clean, 1=issues found
        bandit_data = json.loads(bandit_result.stdout)
        high_severity = len([r for r in bandit_data['results'] 
                           if r['issue_severity'] == 'HIGH'])
        metrics['security_high_issues'] = high_severity
    
    return metrics

if __name__ == "__main__":
    metrics = collect_quality_metrics()
    print(json.dumps(metrics, indent=2))
```

== ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒªã‚½ãƒ¼ã‚¹

=== ğŸ“– å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

* **<<backend-architecture>>**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
* **<<testing-strategy>>**: è©³ç´°ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
* **<<configuration-guide>>**: è¨­å®šã‚¬ã‚¤ãƒ‰
* **<<performance-optimization>>**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

=== ğŸ”— å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹

* **PEP 8**: https://pep8.org/
* **Black**: https://black.readthedocs.io/
* **pytest**: https://docs.pytest.org/
* **mypy**: https://mypy.readthedocs.io/
* **Flask**: https://flask.palletsprojects.com/

=== ğŸ› ï¸ é–‹ç™ºãƒ„ãƒ¼ãƒ«

```bash
# æ¨å¥¨é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install black isort flake8 mypy pytest pytest-cov bandit safety

# ãƒ—ãƒªã‚³ãƒŸãƒƒãƒˆãƒ•ãƒƒã‚¯è¨­å®š
pip install pre-commit
pre-commit install

# ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«
pip install ipython jupyter pdbpp
```

---

**ğŸ“ Contact**: team@kanshichan.dev +
**ğŸ”— Repository**: https://github.com/kanshichan/backend +
**ğŸ“… Last Updated**: {docdate} +
**ğŸ“ Document Version**: {revnumber} 