= ⚙️ 監視ちゃん(KanshiChan) 設定ガイド
:toc: left
:toc-title: 目次
:toclevels: 4
:numbered:
:source-highlighter: highlight.js
:icons: font
:doctype: book
:version: 2.0.0
:author: KanshiChan Development Team
:email: team@kanshichan.dev
:revnumber: 2.0
:revdate: {docdate}
:experimental:

== 📖 概要

監視ちゃん（KanshiChan）のシステム設定に関する包括的なガイドです。
このドキュメントでは、config.yamlの詳細設定、環境別最適化、セキュリティ設定、パフォーマンスチューニングについて説明します。

[NOTE]
====
📋 **ドキュメント情報**

* **対象読者**: システムエンジニア、インフラエンジニア、DevOpsエンジニア
* **技術スタック**: Python 3.9+ / Flask 2.3+ / YAML設定
* **バージョン**: v2.0.0 (AI最適化・国際化対応・TTS統合版)
* **最終更新**: {docdate}
====

== 🎯 設定システム概要

=== 💡 設定管理原則

==== 設計思想
* **階層設定**: 設定の優先順位と継承
* **環境分離**: 開発・テスト・本番環境の分離
* **動的更新**: ホットリロード対応
* **バリデーション**: 設定値の自動検証
* **セキュリティ**: 機密情報の安全な管理

==== 設定ソース優先順位
[cols="1,3,2", options="header"]
|===
|優先順位 |設定ソース |用途
|**1 (最高)** |コマンドライン引数 |実行時オーバーライド
|**2** |環境変数 |環境固有設定
|**3** |config.yaml |メイン設定ファイル
|**4 (最低)** |デフォルト値 |フォールバック値
|===

=== 🏗️ 設定アーキテクチャ

[mermaid]
....
graph TB
    subgraph "📥 Configuration Sources"
        CLI[Command Line<br/>引数オーバーライド]
        ENV[Environment Variables<br/>環境固有設定]
        YAML[config.yaml<br/>メイン設定]
        DEFAULT[Default Values<br/>デフォルト値]
    end
    
    subgraph "🔧 ConfigManager"
        LOADER[Config Loader<br/>設定読み込み]
        MERGER[Config Merger<br/>設定マージ]
        VALIDATOR[Validator<br/>設定検証]
        CACHE[Config Cache<br/>設定キャッシュ]
    end
    
    subgraph "🎯 Configuration Categories"
        SYSTEM[System Config<br/>システム基本設定]
        AI[AI/ML Config<br/>AI・機械学習設定]
        ALERT[Alert Config<br/>アラート・通知設定]
        PERF[Performance Config<br/>パフォーマンス設定]
        SECURITY[Security Config<br/>セキュリティ設定]
    end
    
    subgraph "🔄 Runtime Management"
        HOT[Hot Reload<br/>動的更新]
        MONITOR[Config Monitor<br/>変更監視]
        BACKUP[Config Backup<br/>設定バックアップ]
        RESTORE[Config Restore<br/>設定復元]
    end
    
    %% フロー
    CLI --> LOADER
    ENV --> LOADER
    YAML --> LOADER
    DEFAULT --> LOADER
    
    LOADER --> MERGER
    MERGER --> VALIDATOR
    VALIDATOR --> CACHE
    
    CACHE --> SYSTEM
    CACHE --> AI
    CACHE --> ALERT
    CACHE --> PERF
    CACHE --> SECURITY
    
    CACHE --> HOT
    HOT --> MONITOR
    MONITOR --> BACKUP
    BACKUP --> RESTORE
    
    %% スタイリング
    classDef sources fill:#e6f3ff,stroke:#4488ff
    classDef manager fill:#fff3e6,stroke:#ff8844
    classDef categories fill:#f3ffe6,stroke:#44aa44
    classDef runtime fill:#ffe6f3,stroke:#ff44aa
    
    class CLI,ENV,YAML,DEFAULT sources
    class LOADER,MERGER,VALIDATOR,CACHE manager
    class SYSTEM,AI,ALERT,PERF,SECURITY categories
    class HOT,MONITOR,BACKUP,RESTORE runtime
....

== 📋 config.yaml 完全リファレンス

=== 🔧 システム基本設定

==== サーバー設定
```yaml
# サーバー・アプリケーション基本設定
server:
  # バインドアドレス（本番環境では要変更）
  host: "0.0.0.0"
  
  # ポート番号
  port: 8000
  
  # デバッグモード（本番環境では false 必須）
  debug: false
  
  # スレッド数
  threaded: true
  
  # CORS設定
  cors:
    enabled: true
    origins: 
      - "http://localhost:3000"      # フロントエンド開発環境
      - "http://127.0.0.1:3000"      # ローカルアクセス
    allow_credentials: true
    
  # SSL/TLS設定
  ssl:
    enabled: false
    cert_file: ""
    key_file: ""
```

==== アプリケーション設定
```yaml
# アプリケーション全般設定
app:
  # アプリケーション名
  name: "KanshiChan"
  
  # バージョン
  version: "2.0.0"
  
  # 言語設定
  language:
    default: "ja"                    # デフォルト言語
    supported: ["ja", "en"]          # サポート言語
    
  # ログ設定
  logging:
    level: "INFO"                    # ログレベル: DEBUG/INFO/WARNING/ERROR/CRITICAL
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    file_path: "logs/kanshichan.log"
    max_size_mb: 100                 # ログファイル最大サイズ
    backup_count: 5                  # ローテーション保持数
    
  # データベース設定
  database:
    url: "sqlite:///data/kanshichan.db"
    echo: false                      # SQLログ出力
    pool_size: 10
    max_overflow: 20
    pool_timeout: 30
    pool_recycle: 3600              # 接続リサイクル時間（秒）
```

=== 🤖 AI・機械学習設定

==== YOLO物体検出設定
```yaml
# YOLO v8 物体検出設定
yolo:
  # 基本設定
  enabled: true
  model_path: "yolov8n.pt"           # モデルファイルパス
  
  # 検出パラメータ
  detection:
    confidence_threshold: 0.5        # 信頼度閾値
    iou_threshold: 0.7              # IoU閾値（NMS）
    max_detections: 10              # 最大検出数
    classes:                        # 検出対象クラス
      - 0                           # person
      - 67                          # cell phone
    
  # デバイス設定
  device:
    auto_select: true               # 自動デバイス選択
    preferred: "auto"               # auto/cpu/cuda/mps
    fallback_to_cpu: true           # GPU失敗時CPU使用
    
  # 最適化設定
  optimization:
    half_precision: false           # 半精度計算（CPU無効）
    tensorrt: false                 # TensorRT最適化
    dynamic_shapes: true            # 動的形状対応
    
  # バッチ処理
  batch:
    enabled: false                  # バッチ処理有効
    size: 1                         # バッチサイズ
    timeout_ms: 100                 # バッチタイムアウト
```

==== MediaPipe姿勢検出設定
```yaml
# MediaPipe 姿勢・手・顔検出設定
mediapipe:
  # 全般設定
  enabled: true
  
  # 姿勢検出
  pose:
    enabled: true
    model_complexity: 0             # 0:軽量 1:中 2:高精度
    min_detection_confidence: 0.7   # 検出信頼度閾値
    min_tracking_confidence: 0.7    # 追跡信頼度閾値
    smooth_landmarks: true          # ランドマーク平滑化
    enable_segmentation: false      # セグメンテーション
    
  # 手検出
  hands:
    enabled: false
    max_num_hands: 2                # 最大検出手数
    min_detection_confidence: 0.5
    min_tracking_confidence: 0.5
    
  # 顔検出
  face:
    enabled: false
    max_num_faces: 1                # 最大検出顔数
    refine_landmarks: true          # ランドマーク詳細化
    min_detection_confidence: 0.5
    min_tracking_confidence: 0.5
```

==== AI最適化設定
```yaml
# AI処理最適化設定
ai_optimization:
  # 全般設定
  enabled: true
  target_fps: 15.0                  # 目標FPS
  min_fps: 10.0                     # 最低FPS
  max_fps: 30.0                     # 最大FPS
  
  # フレーム最適化
  frame_optimization:
    auto_resize: true               # 自動リサイズ
    max_width: 640                  # 最大幅
    max_height: 480                 # 最大高さ
    quality_vs_speed: 0.7           # 品質vs速度バランス（0:速度重視 1:品質重視）
    
  # フレームスキップ
  frame_skip:
    enabled: true                   # フレームスキップ有効
    max_skip: 3                     # 最大スキップフレーム数
    performance_threshold: 0.8      # 性能閾値
    
  # GPU設定
  gpu:
    memory_limit: 0.8               # GPU メモリ使用率上限
    allow_growth: true              # メモリ動的確保
    mixed_precision: false          # 混合精度計算
    
  # メモリ管理
  memory:
    cache_size_mb: 512              # キャッシュサイズ
    gc_interval: 300                # GC実行間隔（秒）
    force_gc_memory_threshold: 0.9  # 強制GC閾値
```

=== 📹 カメラ・映像設定

```yaml
# カメラ・映像処理設定
camera:
  # カメラデバイス
  device:
    index: 0                        # カメラデバイスインデックス
    width: 640                      # キャプチャ幅
    height: 480                     # キャプチャ高さ
    fps: 30                         # キャプチャFPS
    
  # 映像品質
  quality:
    brightness: 0                   # 明度調整 (-100 to 100)
    contrast: 0                     # コントラスト調整 (-100 to 100)
    saturation: 0                   # 彩度調整 (-100 to 100)
    auto_exposure: true             # 自動露出
    
  # 前処理
  preprocessing:
    flip_horizontal: false          # 水平反転
    flip_vertical: false            # 垂直反転
    rotation: 0                     # 回転角度（度）
    crop:                           # クロップ設定
      enabled: false
      x: 0
      y: 0
      width: 640
      height: 480
      
# フレーム処理設定
frame_processing:
  # バッファ設定
  buffer:
    size: 10                        # フレームバッファサイズ
    drop_on_full: true              # バッファ満杯時フレーム破棄
    
  # フィルタ設定
  filters:
    noise_reduction: false          # ノイズ除去
    blur_reduction: false           # ブラー軽減
    histogram_equalization: false   # ヒストグラム均等化
```

=== 🔔 アラート・通知設定

```yaml
# アラート・通知システム設定
alerts:
  # 全般設定
  enabled: true
  
  # アラート種別設定
  types:
    absence:                        # 離席アラート
      enabled: true
      threshold_seconds: 300        # 閾値（秒）
      repeat_interval: 600          # 繰り返し間隔（秒）
      max_repeats: 3                # 最大繰り返し回数
      
    smartphone:                     # スマートフォン検出アラート
      enabled: true
      threshold_seconds: 10         # 閾値（秒）
      repeat_interval: 300          # 繰り返し間隔（秒）
      max_repeats: 5                # 最大繰り返し回数
      
    posture:                        # 姿勢アラート
      enabled: true
      threshold_score: 0.3          # 姿勢スコア閾値
      threshold_duration: 120       # 継続時間閾値（秒）
      repeat_interval: 900          # 繰り返し間隔（秒）
      
  # 通知方法設定
  notifications:
    sound:                          # 音声通知
      enabled: true
      volume: 0.8                   # 音量（0.0-1.0）
      
    tts:                            # TTS音声通知
      enabled: true
      voice_id: "default"
      emotion: "neutral"
      
    line:                           # LINE通知
      enabled: false
      token: ""                     # LINE Notify トークン
      
  # 抑制設定
  suppression:
    quiet_hours:                    # 静音時間
      enabled: false
      start_time: "22:00"
      end_time: "08:00"
      
    do_not_disturb:                 # 邪魔しないモード
      enabled: false
      duration_minutes: 60
```

=== 🔊 TTS音声合成設定

```yaml
# TTS（Text-to-Speech）設定
tts:
  # TTS エンジン設定
  engine:
    type: "zonos"                   # エンジンタイプ: zonos/system
    model: "Zyphra/Zonos-v0.1-transformer"
    
  # 音声設定
  voice:
    default_voice_id: "default"
    speed: 1.0                      # 話速（0.5-2.0）
    pitch: 1.0                      # ピッチ（0.5-2.0）
    volume: 0.8                     # 音量（0.0-1.0）
    
  # 感情設定
  emotion:
    default: "neutral"              # デフォルト感情
    context_aware: true             # 文脈に応じた感情調整
    
  # キャッシュ設定
  cache:
    enabled: true                   # 音声キャッシュ
    max_size_mb: 100                # 最大キャッシュサイズ
    ttl_seconds: 86400              # キャッシュ保持時間
    
  # ファイル設定
  files:
    output_format: "wav"            # 出力フォーマット: wav/mp3
    sample_rate: 22050              # サンプリングレート
    bit_depth: 16                   # ビット深度
    
  # 多言語設定
  languages:
    default: "ja"                   # デフォルト言語
    auto_detect: true               # 自動言語検出
    fallback: "en"                  # フォールバック言語
```

=== 📊 監視・分析設定

```yaml
# 監視・分析システム設定
monitoring:
  # 基本監視設定
  enabled: true
  interval_seconds: 2               # 監視間隔（秒）
  
  # データ収集設定
  data_collection:
    enabled: true
    batch_size: 100                 # バッチサイズ
    flush_interval_seconds: 30      # フラッシュ間隔
    
  # 分析設定
  analysis:
    realtime: true                  # リアルタイム分析
    batch_interval_seconds: 3600    # バッチ分析間隔
    
  # 統計設定
  statistics:
    window_size_minutes: 60         # 統計ウィンドウサイズ
    history_retention_days: 30      # 履歴保持日数
    
# パフォーマンス監視設定
performance:
  # システムリソース監視
  system:
    enabled: true
    cpu_threshold: 80               # CPU使用率閾値（%）
    memory_threshold: 80            # メモリ使用率閾値（%）
    disk_threshold: 90              # ディスク使用率閾値（%）
    
  # AI処理性能監視
  ai_performance:
    enabled: true
    fps_threshold: 10               # 最低FPS閾値
    latency_threshold_ms: 200       # 遅延閾値（ミリ秒）
    accuracy_threshold: 0.8         # 精度閾値
```

=== 🛡️ セキュリティ設定

```yaml
# セキュリティ設定
security:
  # 基本セキュリティ
  enabled: true
  
  # データ保護
  data_protection:
    encrypt_sensitive_data: true    # 機密データ暗号化
    anonymize_logs: true            # ログ匿名化
    data_retention_days: 90         # データ保持期間
    
  # アクセス制御
  access_control:
    require_authentication: false   # 認証要求（ローカル環境では無効）
    allowed_origins:                # 許可されたオリジン
      - "http://localhost:3000"
      - "http://127.0.0.1:3000"
      
  # プライバシー保護
  privacy:
    local_processing_only: true     # ローカル処理のみ
    no_cloud_storage: true          # クラウドストレージ不使用
    gdpr_compliance: true           # GDPR準拠
    
  # 監査ログ
  audit:
    enabled: true
    log_level: "INFO"
    retention_days: 365             # 監査ログ保持期間
```

== 🌍 環境別設定戦略

=== 🏠 開発環境設定

==== development.yaml
```yaml
# 開発環境固有設定
app:
  debug: true                       # デバッグ有効
  logging:
    level: "DEBUG"                  # 詳細ログ

server:
  host: "127.0.0.1"                 # ローカルのみ
  port: 8000

yolo:
  device:
    preferred: "cpu"                # 開発用CPU使用

ai_optimization:
  target_fps: 10.0                  # 低FPS（開発用）
  frame_optimization:
    quality_vs_speed: 0.3           # 速度重視

alerts:
  notifications:
    sound:
      volume: 0.3                   # 低音量
```

=== 🧪 テスト環境設定

==== testing.yaml
```yaml
# テスト環境固有設定
app:
  debug: false
  logging:
    level: "WARNING"                # エラー・警告のみ

monitoring:
  enabled: false                    # 監視無効

alerts:
  enabled: false                    # アラート無効

tts:
  cache:
    enabled: false                  # キャッシュ無効
```

=== 🚀 本番環境設定

==== production.yaml
```yaml
# 本番環境固有設定
app:
  debug: false                      # デバッグ無効（必須）
  logging:
    level: "INFO"
    file_path: "/var/log/kanshichan/app.log"

server:
  host: "0.0.0.0"
  port: 8000
  ssl:
    enabled: true                   # SSL有効
    cert_file: "/etc/ssl/certs/kanshichan.crt"
    key_file: "/etc/ssl/private/kanshichan.key"

yolo:
  device:
    preferred: "cuda"               # GPU優先

ai_optimization:
  target_fps: 15.0                  # 標準FPS
  gpu:
    memory_limit: 0.9               # GPU メモリ上限高め

security:
  data_protection:
    encrypt_sensitive_data: true    # 暗号化必須
  audit:
    enabled: true                   # 監査ログ必須

performance:
  system:
    enabled: true                   # パフォーマンス監視必須
```

== ⚙️ 環境変数管理

=== 📋 環境変数一覧

[cols="3,2,4", options="header"]
|===
|環境変数名 |デフォルト値 |説明
|**KANSHICHAN_CONFIG_PATH** |`config/config.yaml` |設定ファイルパス
|**KANSHICHAN_ENV** |`development` |実行環境
|**KANSHICHAN_DEBUG** |`false` |デバッグモード
|**KANSHICHAN_LOG_LEVEL** |`INFO` |ログレベル
|**KANSHICHAN_HOST** |`localhost` |バインドホスト
|**KANSHICHAN_PORT** |`8000` |ポート番号
|**KANSHICHAN_GPU_ENABLED** |`auto` |GPU使用設定
|**KANSHICHAN_YOLO_MODEL** |`yolov8n.pt` |YOLOモデルパス
|**LINE_NOTIFY_TOKEN** |`""` |LINE通知トークン
|**TTS_CACHE_DIR** |`cache/tts` |TTSキャッシュディレクトリ
|===

=== 🔧 環境変数設定例

==== .env ファイル
```bash
# KanshiChan 環境変数設定
KANSHICHAN_ENV=production
KANSHICHAN_DEBUG=false
KANSHICHAN_LOG_LEVEL=INFO
KANSHICHAN_HOST=0.0.0.0
KANSHICHAN_PORT=8000

# GPU設定
KANSHICHAN_GPU_ENABLED=true

# セキュリティ
KANSHICHAN_SECRET_KEY=your-secret-key-here

# 外部サービス
LINE_NOTIFY_TOKEN=your-line-token-here

# パフォーマンス
KANSHICHAN_MAX_WORKERS=4
KANSHICHAN_WORKER_TIMEOUT=30
```

==== Docker環境変数
```dockerfile
# Dockerfile内での環境変数設定
ENV KANSHICHAN_ENV=production
ENV KANSHICHAN_CONFIG_PATH=/app/config/production.yaml
ENV KANSHICHAN_LOG_LEVEL=INFO
ENV KANSHICHAN_GPU_ENABLED=auto
```

== 🔧 設定変更・管理手順

=== 📝 設定変更の基本手順

[mermaid]
....
graph TD
    START[設定変更開始] --> BACKUP[現在の設定をバックアップ]
    BACKUP --> EDIT[設定ファイル編集]
    EDIT --> VALIDATE[設定値検証]
    VALIDATE --> TEST[テスト環境で動作確認]
    TEST --> DEPLOY[本番環境への適用]
    DEPLOY --> MONITOR[動作監視]
    MONITOR --> END[設定変更完了]
    
    VALIDATE -->|検証エラー| FIX[設定値修正]
    FIX --> VALIDATE
    
    TEST -->|テスト失敗| ROLLBACK[設定ロールバック]
    ROLLBACK --> BACKUP
    
    DEPLOY -->|適用失敗| EMERGENCY[緊急ロールバック]
    EMERGENCY --> BACKUP
    
    classDef normal fill:#e6f3ff
    classDef error fill:#ffe6e6
    classDef success fill:#e6ffe6
    
    class START,BACKUP,EDIT,VALIDATE,TEST,DEPLOY,MONITOR,END normal
    class FIX,ROLLBACK,EMERGENCY error
....

=== 🔄 ホットリロード機能

==== 設定ホットリロード対応項目
[cols="3,2,3", options="header"]
|===
|設定カテゴリ |リロード対応 |注意事項
|**ログレベル** |✅ |即座に反映
|**アラート設定** |✅ |即座に反映
|**AI最適化設定** |✅ |次フレームから反映
|**TTS設定** |✅ |次回合成時から反映
|**サーバー設定** |❌ |再起動必要
|**AI モデル設定** |❌ |再起動必要
|**データベース設定** |❌ |再起動必要
|===

==== ホットリロード実行方法
```bash
# 設定リロード API経由
curl -X POST http://localhost:8000/api/config/reload

# シグナル経由（UNIX系）
kill -USR1 <pid>

# 設定ファイル監視（自動リロード）
# FileSystemWatcher が変更を検知して自動実行
```

=== 💾 設定バックアップ・復元

==== 設定バックアップ
```bash
# 手動バックアップ
python -m kanshichan.tools.config backup --output config_backup_20240115.yaml

# 自動バックアップ（変更前）
# ConfigManager が自動的に実行
```

==== 設定復元
```bash
# 特定バックアップから復元
python -m kanshichan.tools.config restore --input config_backup_20240115.yaml

# 前回設定に戻す
python -m kanshichan.tools.config rollback
```

== ✅ 設定値検証・バリデーション

=== 🔍 自動バリデーション

==== バリデーションルール
[cols="2,3,3", options="header"]
|===
|設定項目 |バリデーションルール |エラー時の動作
|**FPS設定** |1.0 ≤ fps ≤ 60.0 |デフォルト値使用
|**ポート番号** |1024 ≤ port ≤ 65535 |エラー終了
|**メモリ制限** |0.1 ≤ memory_limit ≤ 1.0 |デフォルト値使用
|**ファイルパス** |ファイル存在確認 |警告ログ出力
|**URL形式** |URL形式チェック |エラー終了
|===

==== カスタムバリデーション
```python
# config/validators.py
from dataclasses import dataclass
from typing import Any, List

@dataclass
class ValidationResult:
    is_valid: bool
    errors: List[str]
    warnings: List[str]

class ConfigValidator:
    def validate_ai_settings(self, config: dict) -> ValidationResult:
        """AI設定のカスタムバリデーション"""
        errors = []
        warnings = []
        
        # YOLO設定チェック
        if config.get('yolo', {}).get('enabled', False):
            model_path = config['yolo'].get('model_path')
            if not os.path.exists(model_path):
                errors.append(f"YOLO model not found: {model_path}")
        
        # GPU設定チェック
        if config.get('yolo', {}).get('device', {}).get('preferred') == 'cuda':
            if not torch.cuda.is_available():
                warnings.append("CUDA not available, falling back to CPU")
        
        return ValidationResult(
            is_valid=len(errors) == 0,
            errors=errors,
            warnings=warnings
        )
```

=== 🧪 設定テストユーティリティ

==== 設定テストスクリプト
```bash
# 設定ファイル検証
python -m kanshichan.tools.config validate --config config/production.yaml

# 設定テスト実行
python -m kanshichan.tools.config test --config config/production.yaml --dry-run

# 設定差分確認
python -m kanshichan.tools.config diff --old config/config.yaml.bak --new config/config.yaml
```

==== テスト項目
* **構文チェック**: YAML構文の正確性
* **必須項目**: 必須設定項目の存在確認
* **データ型**: 設定値のデータ型チェック
* **範囲チェック**: 数値の有効範囲確認
* **依存関係**: 設定間の依存関係確認
* **外部リソース**: ファイル・ディレクトリの存在確認

== 🚀 パフォーマンスチューニング

=== ⚡ 基本パフォーマンス最適化

==== 低性能環境向け設定
```yaml
# 低性能環境最適化設定
ai_optimization:
  target_fps: 8.0                   # 低FPS
  frame_optimization:
    auto_resize: true
    max_width: 320                  # 低解像度
    max_height: 240
    quality_vs_speed: 0.2           # 速度重視

yolo:
  device:
    preferred: "cpu"                # CPU使用
  optimization:
    half_precision: false           # CPU では無効

mediapipe:
  pose:
    model_complexity: 0             # 最軽量モデル
  hands:
    enabled: false                  # 無効化
  face:
    enabled: false                  # 無効化

monitoring:
  interval_seconds: 5               # 監視間隔延長
```

==== 高性能環境向け設定
```yaml
# 高性能環境最適化設定
ai_optimization:
  target_fps: 30.0                  # 高FPS
  frame_optimization:
    max_width: 1280                 # 高解像度
    max_height: 720
    quality_vs_speed: 0.8           # 品質重視

yolo:
  device:
    preferred: "cuda"               # GPU使用
  optimization:
    half_precision: true            # 半精度計算
    tensorrt: true                  # TensorRT最適化

mediapipe:
  pose:
    model_complexity: 2             # 高精度モデル
  hands:
    enabled: true                   # 手検出有効
  face:
    enabled: true                   # 顔検出有効

ai_optimization:
  gpu:
    memory_limit: 0.9               # GPU メモリ上限高め
  memory:
    cache_size_mb: 1024             # 大容量キャッシュ
```

=== 📊 チューニング指標

==== パフォーマンス目標値
[cols="2,2,2,2", options="header"]
|===
|環境 |目標FPS |CPU使用率 |メモリ使用量
|**低性能** |8-10 FPS |<70% |<1GB
|**標準** |12-15 FPS |<80% |<2GB
|**高性能** |20-30 FPS |<70% |<4GB
|**サーバー** |15+ FPS |<60% |<8GB
|===

==== チューニング手順
1. **ベースライン測定**: 現在の性能測定
2. **ボトルネック特定**: CPU/GPU/メモリの制約特定
3. **設定調整**: ボトルネックに応じた設定変更
4. **効果測定**: 変更後の性能測定
5. **反復改善**: 目標達成まで反復

== 🛡️ セキュリティ強化設定

=== 🔒 基本セキュリティ対策

==== 本番環境セキュリティ設定
```yaml
# 本番環境セキュリティ強化
security:
  # データ保護強化
  data_protection:
    encrypt_sensitive_data: true
    anonymize_logs: true
    secure_delete: true             # 安全削除
    data_retention_days: 30         # 短期保持
    
  # アクセス制御強化
  access_control:
    ip_whitelist:                   # IP制限
      - "192.168.1.0/24"
      - "10.0.0.0/8"
    rate_limiting:
      enabled: true
      requests_per_minute: 60
      
  # SSL/TLS強化
  ssl:
    min_version: "TLSv1.2"          # 最小TLSバージョン
    cipher_suites:                  # 許可される暗号スイート
      - "ECDHE-RSA-AES256-GCM-SHA384"
      - "ECDHE-RSA-AES128-GCM-SHA256"
      
  # ヘッダーセキュリティ
  headers:
    x_frame_options: "DENY"
    x_content_type_options: "nosniff"
    x_xss_protection: "1; mode=block"
    strict_transport_security: "max-age=31536000; includeSubDomains"
```

=== 🔐 機密情報管理

==== 環境変数による機密情報管理
```bash
# 機密情報は環境変数で管理
export KANSHICHAN_SECRET_KEY="your-secret-key"
export KANSHICHAN_ENCRYPTION_KEY="your-encryption-key"
export LINE_NOTIFY_TOKEN="your-line-token"
export SSL_CERT_PASSPHRASE="your-cert-passphrase"
```

==== HashiCorp Vault連携（企業環境）
```yaml
# Vault連携設定
vault:
  enabled: false                    # 企業環境でのみ有効
  endpoint: "https://vault.company.com"
  auth_method: "kubernetes"
  secret_path: "secret/kanshichan"
```

== 🔧 トラブルシューティング

=== ⚠️ よくある設定問題

==== 設定読み込みエラー
[cols="3,4,3", options="header"]
|===
|問題 |原因 |対処法
|**設定ファイルが見つからない** |パス間違い・ファイル不存在 |パス確認・ファイル作成
|**YAML構文エラー** |インデント・引用符の問題 |YAML バリデータで確認
|**設定値型エラー** |文字列・数値の型不一致 |データ型を正しく設定
|**必須項目不足** |必須設定項目の欠落 |必須項目を追加
|**権限エラー** |ファイル読み書き権限不足 |ファイル権限を修正
|===

==== パフォーマンス問題
[cols="3,4,3", options="header"]
|===
|問題 |原因 |対処法
|**FPS が目標値未達** |CPU/GPU負荷過多 |解像度・FPS設定を下げる
|**メモリ不足** |キャッシュサイズ過大 |キャッシュサイズを削減
|**GPU利用不可** |CUDA環境不備 |CPU フォールバック設定
|**起動時間過長** |モデル読み込み時間 |軽量モデルに変更
|**アラート遅延** |処理バックログ |監視間隔を調整
|===

=== 🔍 診断ツール

==== 設定診断コマンド
```bash
# 設定総合診断
python -m kanshichan.tools.config diagnose

# パフォーマンス診断
python -m kanshichan.tools.config perf-test --duration 60

# セキュリティ診断
python -m kanshichan.tools.config security-check
```

==== ログ分析
```bash
# 設定関連エラーを抽出
grep "ConfigError\|ValidationError" logs/kanshichan.log

# パフォーマンス問題を分析
grep "FPS\|Performance\|Memory" logs/kanshichan.log | tail -100
```

== 📚 関連ドキュメント

=== 📖 参照ドキュメント
* **<<backend-architecture>>**: システム全体アーキテクチャ
* **<<installation-setup>>**: インストール・セットアップガイド
* **<<detection-system>>**: AI検出システム詳細
* **<<performance-optimization>>**: パフォーマンス最適化

=== 🔗 設定テンプレート
* **開発環境テンプレート**: `config/templates/development.yaml`
* **本番環境テンプレート**: `config/templates/production.yaml`
* **Docker環境テンプレート**: `config/templates/docker.yaml`
* **高性能環境テンプレート**: `config/templates/high-performance.yaml`

---

**📞 Contact**: team@kanshichan.dev +
**🔗 Repository**: https://github.com/kanshichan/backend +
**📅 Last Updated**: {docdate} +
**📝 Document Version**: {revnumber} 