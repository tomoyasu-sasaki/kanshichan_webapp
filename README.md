# KanshiChan
監視ちゃんシステム - 人体検出および通知システム

## システム概要

監視ちゃんは以下の主要機能を提供します：

### 1. 監視機能 🎥
- **使用技術**: OpenCV, MediaPipe
- **処理フロー**:
  1. カメラからリアルタイム映像を取得
  2. MediaPipeで人物の姿勢を検出
  3. YOLOv8でスマートフォンを検出
  4. 検出結果を画面上にリアルタイム表示

### 2. 行動分析機能 🤖
- **使用技術**: TinyLlama（ローカルLLM）
- **処理フロー**:
  1. 30秒ごとに現在の状況を分析
  2. 以下の状態を判定：
     - 着席/離席状態
     - スマートフォン使用状態
     - 学習への集中度
  3. LLMが状況に応じた適切なアドバイスを生成

### 3. 通知機能 📱
- **使用技術**: LINE Messaging API, Playsound
- **処理フロー**:
  1. 問題行動を検出（離席・スマホ使用など）
  2. LINE通知を送信
  3. 音声アラートを再生

### 4. Web API機能 🌐
- **使用技術**: Flask
- **処理フロー**:
  1. LINEからのWebhookを受信
  2. メッセージに応じた処理を実行：
     - 離席許可時間の延長
     - 音声応答の再生

## 使用技術の詳細

### 画像処理・検出
- **OpenCV**: カメラ映像の取得・表示
- **MediaPipe**: 人物の姿勢推定
- **YOLOv8**: スマートフォン検出
- **用途**: リアルタイムでの行動監視

### AI・機械学習
- **TinyLlama**: 軽量なローカルLLM
- **用途**: 状況理解と適切なアドバイス生成

### 通知システム
- **LINE API**: メッセージ通知
- **Playsound**: 音声アラート
- **用途**: ユーザーへのフィードバック

### Webサーバー
- **Flask**: Webアプリケーション
- **用途**: LINE Webhookの処理、API提供

## 処理の流れ

1. **起動時**:
   ```
   メインプログラム起動
   ↓
   設定ファイル読み込み
   ↓
   各サービス初期化（カメラ、検出器、LLM、通知）
   ↓
   Flaskサーバー起動
   ```

2. **監視処理**:
   ```
   カメラ映像取得
   ↓
   人物検出処理
   ↓
   スマートフォン検出処理
   ↓
   行動分析（LLM）
   ↓
   必要に応じて通知
   ```

3. **LINE連携**:
   ```
   LINEからメッセージ受信
   ↓
   メッセージ内容確認
   ↓
   対応する処理実行（時間延長など）
   ↓
   音声応答再生
   ```

## 手順

### 仮想環境を作成

```bash
python -m venv .kanshichan
```

### 仮想環境を有効化

```bash
source .kanshichan/bin/activate
```

### wheelをインストール

```bash
pip install wheel==0.45.1
```

### 依存関係をインストール

```bash
pip install -r requirements.txt
```

### メインプログラムを実行

```bash
python -m src.kanshichan.main
```

### 仮想環境を無効化

```bash
deactivate
```

### 仮想環境を削除  

```bash
rm -rf .kanshichan
```
